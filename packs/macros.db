{"name":"Instant Defaults","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/sundries/flags/banner-yellow.webp","scope":"global","command":"InstantDefaults.skillChooser()","flags":{"advanced-macros":{"runAsGM":false},"core":{"sourceId":"Macro.JDV9ZoJ2Q6vQUSql"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547621,"modifiedTime":1669696547621,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"02odDoOhUa4nemQ7"}
{"name":"Throwing Calculator","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/skills/ranged/bomb-grenade-thrown-purple.webp","scope":"global","command":"// // if (canvas.tokens.controlled.length === 0)\n// //   return ui.notifications.error(\"Select the falling token\");\n\n if (canvas.tokens.controlled.length === 0)\n  return ui.notifications.error(\"Select a token\");\n\n\n\nconst myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/throwing.html\");\n\nnew Dialog({\n  title: \"GURPS\",\n  content: myContent,\n  buttons: {}\n}, { id: 'GURPScss'}).render(true);","flags":{"core":{"sourceId":"Macro.IbF4f8qjepR6bZ9t"},"cf":{"id":"temp_etvk8gr4cam"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547621,"modifiedTime":1669696547621,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"0TAheGWP5AROQwLb"}
{"name":"mostra imagem de token","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"const options = canvas.tokens.placeables.filter(t => !t.data.hidden).reduce((acc, t) => \n    acc += `<label><img src=\"${t.actor.data.img}\" title=\"${t.data.name}\"></label>`, \n``);\n\nconst content = `\n    <style>\n        #tokenList {\n            margin:10px;\n        }\n        #tokenList.form-group img {\n            border:0px;\n            height:60px;\n            min-width:60px;\n        }\n        #tokenList.form-group img:hover {\n            transform: scale(2);\n        }\n    </style>\n    <form>\n        <div class=\"form-group\" id=\"tokenList\">\n            ${options}\n        </div>\n    </form>`;\n\n\nconst d = new Dialog({\n    title: \"Show Token Art\",\n    content,\n    buttons: {\n        ok: {\n            label: \"ok\"\n        }\n    },\n    default: \"yes\",\n    render: (html) => {\n        html.find(\"#tokenList img\").click(function() {\n            const popout = new ImagePopout(this.src);\n            popout.render(true);\n        });\n    }    \n},\n{\n    width: 650\n}).render(true);","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670044466435,"modifiedTime":1670259507351,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"4SKuNAbusiwekKpM"}
{"name":"interessante","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"const image1 = `https://i.imgur.com/image1.png`;\nconst image2 = `https://i.imgur.com/image2.png`;\nconst image3 = `https://i.imgur.com/image3.png`;\nconst image4 = `https://i.imgur.com/image4.png`;\nconst image5 = `https://i.imgur.com/image5.png`;\n\nlet d = new Dialog({\ntitle: \"Tokens\",\nbuttons: {\none: {\n label: `<img src= \"${image1}\">`,\n callback: () => {token.document.update({ \"texture.src\": image1 })}\n},\ntwo: {\n  label: `<img src= \"${image2}\">`,\n  callback: () => {token.document.update({ \"texture.src\": image2 })}\n },\n three: {\n  label: `<img src= \"${image3}\"`,\n  callback: () => {token.document.update({ \"texture.src\": image3 })}\n },\nfour: {\n  label: `<img src= \"${image4}\"`,\n  callback: () => {token.document.update({ \"texture.src\": image4 })}\n },\nfive: {\n  label: `<img src= \"${image5}\"`,\n  callback: () => {token.document.update({ \"texture.src\": image5 })}\n }\n},\ndefault: \"one\",\nrender: html => console.log(\"Register interactivity in the rendered dialog\"),\nclose: html => console.log(\"This always is logged no matter which option is chosen\")\n});\nd.render(true);","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Compendium.myuselessmacros.GURPS4E-Macro.yf3uPa1nz2nC7MDE"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670033783251,"modifiedTime":1670264336287,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"5oF1nIMcX2Izf0os"}
{"name":"Hiking Calculator","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/skills/movement/feet-winged-sandals-tan.webp","scope":"global","command":"// if (canvas.tokens.controlled.length === 0)\n//   return ui.notifications.error(\"Select the falling token\");\n\nif (canvas.tokens.controlled.length === 0)\n  return ui.notifications.error(\"Select the token leader\");\n\n\n\nconst myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/hiking.html\");\n\nnew Dialog({\n  title: \"GURPS Hiking Calculator\",\n  content: myContent,\n  buttons: {}\n}).render(true);","flags":{"core":{"sourceId":"Macro.TbasT3DKsY3L0nec"},"cf":{"id":"temp_etvk8gr4cam"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547622,"modifiedTime":1669696547622,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"6QQwbjw5DI8Nhy7u"}
{"name":"Macros Folder","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/containers/boxes/crate-heavy-yellow.webp","scope":"global","command":"const managerType = \"Macros Folder\";\n\n(() => {\n  const macros = [\n    \"Random Treasure Generator\",\n    \"Instant Defaults\",\n    \"Tables Folder\",\n    \"Hiking Calculator\",\n    \"Falling Calculator\",\n    \"Throwing Calculator\",\n    \"Sight Togle\",\n    \"Fatigue\",\n    \"Sight Toggle\",\n    \"Sight Adjustment\",\n    \"Body Parts\",\n    \"Healing Tool\"\n\n  ];\n\n  let buttons = {},\n    dialog,\n    content = `<div sytle=\"display:flex;text-align:center;><h2>Choose Macro</h2></div>`;\n\n\n  macros.forEach((str) => {\n    let macro = game.macros.getName(str);\n    if (!macro) return;\n\n    buttons[str] = {\n      label: `\n       \n<style>\n#GURPScs .window-content {\n    background-image: url('systems/gurps/icons/hex2.webp');\n        background-color: #353434;\n        display: inline-block;\n          width: 100%;\n\n\n  }\n\n  \n\n  #GURPScs header {\n    font-family: Roboto;\n    background-color: #353434;\n    border-radius: 0;\n    border: none;\n    margin-bottom: 2px;\n    font-size: .75rem;\n  }\n\n#GURPScs .dialog-button {\n  border: 1px solid #18181a;\n  color: #18181a;\n  font-size: 15px;\n  line-height: 15px;\n  padding: 5px 5px 5px;\n  width: 100%;\n  height: 100%;\n  cursor: cell;\n  background: #807f7f;\n  border-radius: 18px;\n  margin-bottom: 2px;\n      }\n\n    #GURPScs .dialog-button:hover {\n  background-color: #353434; /* Green */\n  color: white;\n    box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19);\n    }\n\n      </style> \n         <div style=\"display:flex;flex-direction:row;justify-content:center;align-items:center;\">\n          \n        <div style=\"display:flex;justify-content:left;flex-grow:1;\">\n        <img src=\"${macro.img}\" width=\"50\" height=\"50\" style=\"background-color:#5c5c5c;;border-radius: 10px;margin: 3px 3px 3px;\"/></div>\n          <source src=\"/sounds/pop.mp3\" type=\"audio/mpeg\">\n\n        <div style=\"display:flex;justify-content:left;flex-grow:1\"><label>${str}</label></div>\n        </div>\n        \n        \n        \n        \n        \n        \n        \n        \n        \n        \n        \n        `,\n      callback: () => {\n        game.macros.getName(str).execute();\n        dialog.render(true);\n      },\n    };\n  });\n  dialog = new Dialog(\n    { title: `${managerType}`, content, buttons },\n    { id: \"GURPScs\" }\n  ).render(true);\n})();","flags":{"core":{"sourceId":"Macro.ul71YhG3o9fguYNU"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547625,"modifiedTime":1669696547625,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"6pvKH4kMzvWgbmcB"}
{"name":"ReactionRoll","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/environment/people/group.webp","scope":"global","command":"let r = new Roll(\"3d6 + @mod\", { mod: GURPS.ModifierBucket.currentSum()})\ngame.tables.getName(\"Reaction Rolls\").draw({roll:r})\nGURPS.ModifierBucket.clear()","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.BAVCAmeEE34jS0dN"},"importid":"SwxFagE3eJmQSiTu","cf":{"id":"temp_58ibxbr8cng"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547622,"modifiedTime":1669696547622,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"8oH7TPH1GJFhi8jN"}
{"name":"Tables Folder","type":"script","author":"mW8b5k19Zu6i2R2v","img":"modules/gurps-instant-defaults/img/icons/critical.png","scope":"global","command":"const managerType = \"Tables Folder\";\n\n(() => {\n  const tables = [\n    \"Critical Head Blow\",\n    \"Critical Hit\",\n    \"Critical Magic\",\n    \"Critical Miss\",\n    \"Critical Unarmed Strike\",\n    \"Reaction Rolls\",\n    \"Sight Toggle\",\n    \"Sight Adjustment\",\n    \"Healing Tool\",\n    \"Body Parts\"\n\n  ];\n\n  let buttons = {},\n    dialog,\n    content = `<div sytle=\"display:flex;text-align:center;><h2>Choose Macro</h2></div>`;\n\n\n  tables.forEach((str) => {\n    let table = game.tables.getName(str);\n    if (!table) return;\n\n    buttons[str] = {\n      label: `\n       \n<style>\n#tf .window-content {\n    background-image: url('systems/gurps/icons/hex2.webp');\n        background-color: #353434;\n        display: inline-block;\n          width: 100%;\n\n\n  }\n\n  \n\n  #bp header {\n    font-family: Roboto;\n    background-color: #353434;\n    border-radius: 0;\n    border: none;\n    margin-bottom: 2px;\n    font-size: .75rem;\n  }\n\n#tf .dialog-button {\n  border: 1px solid #18181a;\n  color: #18181a;\n  font-size: 15px;\n  line-height: 15px;\n  padding: 5px 5px 5px;\n  width: 100%;\n  height: 100%;\n  cursor: cell;\n  background: #807f7f;\n  border-radius: 18px;\n  margin-bottom: 2px;\n      }\n\n    #tf .dialog-button:hover {\n  background-color: #353434; /* Green */\n  color: white;\n    box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19);\n    }\n\n      </style> \n         <div style=\"display:flex;flex-direction:row;justify-content:center;align-items:center;\">\n          \n        <div style=\"display:flex;justify-content:left;flex-grow:1;\">\n        <img src=\"${table.img}\" width=\"50\" height=\"50\" style=\"background-color:#5c5c5c;;border-radius: 10px;margin: 3px 3px 3px;\"/></div>\n          <source src=\"/sounds/pop.mp3\" type=\"audio/mpeg\">\n\n        <div style=\"display:flex;justify-content:left;flex-grow:1\"><label>${str}</label></div>\n        </div>\n        \n        \n        \n        \n        \n        \n        \n        \n        \n        \n        \n        `,\n      callback: () => {\n        game.tables.getName(str).draw();\n        dialog.render(true);\n      },\n    };\n  });\n  dialog = new Dialog(\n    { title: `${managerType}`, content, buttons },\n    { id: \"tf\" }\n  ).render(true);\n})();","flags":{"core":{"sourceId":"Macro.PiqMWUzecRiYnlTN"},"cf":{"id":"temp_58ibxbr8cng"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547625,"modifiedTime":1669696547625,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"AgKR8PJVGy3nBNMH"}
{"name":"Random Treasure Generator","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/commodities/currency/coins-crown-stack-gold.webp","scope":"global","command":"const myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/generator.html\");\n\nnew Dialog({\n  title: \"GURPS\",\n  content: myContent,\n  buttons: {}\n}).render(true);","flags":{"core":{"sourceId":"Macro.wSj4vPsv6Xmxhldm"},"cf":{"id":"temp_etvk8gr4cam"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547625,"modifiedTime":1669696547625,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"EGvJiSUpUUQD7Asg"}
{"name":"Hover","type":"chat","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/air/wind-weather-snow-gusts.webp","command":"//Require TokenMagicFx Module and Jb2a.\n//Don't cry.\n\n\nconst effects = Sequencer.EffectManager.getEffects({ name: \"*Levita*\" });\nconst tokenD = canvas.tokens.controlled[0];\n\n\nif(effects.length){\n  Sequencer.EffectManager.endEffects({ name: \"*Levita*\" });\n  token.document.update({elevation: token.data.elevation =0});\n  \n   TokenMagic.deleteFiltersOnSelected();\n//TokenMagic.addUpdateFiltersOnSelected();\n  }else{\n\ntoken.document.update({elevation: token.data.elevation +10});\n\n\n\n\nnew Sequence()\n    .effect()\n        .file(\"modules/jb2a_patreon/Library/TMFX/OutFlow/Circle/OutFlow_02_Circle_500x500.webm\") \n        .scale(2)\n        .atLocation(tokenD)\n        .attachTo(tokenD, { bindVisibility: false} )\n        .belowTokens()\n        .opacity(0.5)\n        .persist()\n        .name(\"Levita\")\n\n        .effect()\n        .file(\"worlds/comupunk/animations/aviso.webp\") \n        .scale(1.2)\n        .atLocation(tokenD)\n        .attachTo(tokenD, { bindVisibility: false} )\n        .belowTokens()\n        // .spriteOffset({ x: 10, y: 300 })\n        .opacity(0.4)\n        .persist()\n\n\n        .name(\"Levita\")\n\n            \n    .play()\n    \n    let params =\n    [{\n        filterType: \"shadow\",\n        filterId: \"myShadow\",\n        rotation: 195,\n        blur: 3,\n        quality: 5,\n        distance: 20,\n        alpha: 0.6,\n        padding: 20,\n        shadowOnly: false,\n        color: 0x000000,\n        zOrder: 8000,\n        animated:\n        {\n            blur:     \n            { \n               active: true, \n               loopDuration: 500, \n               animType: \"syncCosOscillation\", \n               val1: 2, \n               val2: 4\n            },\n            rotation:\n            {\n               active: true,\n               loopDuration: 100,\n               animType: \"syncSinOscillation\",\n               val1: 33,\n               val2: 37\n            }\n         }\n    }];\n    \n    let params2 =\n        [{\n            filterType: \"transform\",\n            filterId: \"dodgeStance\",\n            padding: 50,\n            animated:\n            {\n                translationX:\n                {\n                    animType: \"sinOscillation\",\n                    val1: -0.060,\n                    val2: +0.060,\n                    loopDuration: 9600,\n                },\n                translationY:\n                {\n                    animType: \"cosOscillation\",\n                    val1: -0.035,\n                    val2: +0.035,\n                    loopDuration: 9400,\n                }\n            }\n        }];\nawait TokenMagic.addUpdateFiltersOnSelected(params);\nawait TokenMagic.addUpdateFiltersOnSelected(params2);\n \n  }","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670263972783,"modifiedTime":1670264091198,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"FjALz9PbTwVGdu2O"}
{"name":"Grenades Distance","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/weapons/thrown/bomb-fuse-red-black.webp","scope":"global","command":"tokenD = canvas.tokens.controlled[0]\nif(!token) return;\nconst targets = Array.from(game.user.targets);\nconst gridSize = canvas.grid.size;\nconst startPoint = {x:tokenD.x,y: tokenD.y};\nlet messageData = \"<h2>Grenade Distance</h2><br>\";\n\nfunction d6(min, max) { \n    return Math.floor(Math.random() * (max - min + 1) + min)\n  }\n\n targets.forEach(async target => {\n    const distance = canvas.grid.measureDistance(startPoint, target, {gridSpaces: true}).toFixed(1); \n    let c = 0 \n    while (c <= 20 ){\n    if (distance == c)messageData += `<b>${target.name}</b> Is <b>${c} yards </b>from grenade <br>`;\n        c++\n}\n    \n});\nChatMessage.create({content: messageData});","flags":{"core":{"sourceId":"Macro.IP19df5Giwp6zFmf"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547621,"modifiedTime":1669696547621,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"FqLB3LKzDMz9HeTt"}
{"name":"Apply Manual Damage","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/skills/wounds/injury-pain-body-orange.webp","scope":"global","command":"function manualDamage(damage, type) {\n  GURPS.executeOTF(`/r [${damage} ${type}]`);\n}\nnew Dialog({\n  title: `Manual Damage`,\n  content: \n`<form>\n<style>\nform#form-group {\n  background-color: red;\n}\n</style>\n <form>\n      <div class=\"form-group\">\n        <label>Damage Type: </label>\n        <select id=\"damageType\" name=\"damageType\">\n          <option value=\"burn\">Burning</option>\n          <option value=\"cor\">Corrosion</option>\n          <option value=\"cr\">Crushing</option>\n          <option value=\"imp\">Impaling</option>\n          <option value=\"pi-\">Smal piercing</option>\n          <option value=\"pi\">Piercing</option>\n          <option value=\"pi+\">Large Piercing</option>\n          <option value=\"pi+\">Large Piercing</option>\n          <option value=\"pi++\">Huge Piercing</option>\n          <option value=\"tox\">Toxic</option>\n          <option value=\"sh\">Shield</option>\n             \n          \n          \n          </select>\n      </div>\n     \n  </form>  \n  \n  <form>\n<div class=\"form-group\">\n  <label>Damage Amount:</label>\n  <input id=\"damageAmount\" name=\"damageAmount\"  value=\"\" min=\"1\" max=\"20\">\n  </div>   \n  `,\n  buttons: {\n    confirm: {\n      label: \"Confirm\",\n      callback: async (html) => {\n        manualDamage(html.find('#damageAmount').val(), html.find('#damageType').val());\n      }\n    }\n  }\n}, {\n  width: 400\n}).render(true);","flags":{"core":{"sourceId":"Macro.Bjf1SqGzABywtOTp"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547623,"modifiedTime":1669696547623,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"Mipo4PgkYWdvN0gW"}
{"name":"Colored Borders","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/symbols/ring-circle-smoke-blue.webp","command":"const myContent = `<style>\n    .callheader {\n      background-color: black;\n      font-family: Roboto, sans-serif;\n      color: white;\n      text-align: center;\n      vertical-align: middle;\n      line-height: 50px;\n      height: 50px;\n      margin-bottom: 10px;\n      border-radius: 0.375rem;\n      font-size: 18px;\n      text-decoration: none;\n    }\n  </style>\n  <div class=\"callheader\">Colored Borders</div>\n\n  <form>\n    <div class=\"form-group\">\n      <label>Size</label>\n      <div class=\"form-fields\">\n        <input id=\"sizes\" type=\"number\" name=\"sizes\">\n      </div>\n    </div>\n  </form>\n  <div class=\"coluna3\">\n    <form>\n      <div class=\"form-group\">\n        <label style=\"text-align: left\">Color </label>\n        <div class=\"form-fields\">\n          <select id=\"cores\" name=\"cores\">\n            <option value=\"yellow\">Yellow</option>\n            <option value=\"Pink\">Purple</option>\n            <option value=\"blue\">Blue</option>\n            <option value=\"bluewhite\">Blue White</option>\n            <option value=\"Pink\">Pink</option>\n            <option value=\"Red\">Red</option>\n            <option value=\"Orange\">Orange</option>\n            <option value=\"Red\">Red</option>\n            <option value=\"White\">White</option>\n            <option value=\"Green\">Green</option>     \n            <option value=\"sides\">Sides</option>       \n              <option value=\"cyberpunk\">Cyberpunk</option>       \n\n          </select>\n        </div>\n      </div>\n    </form>\n  </div>\n  <br>\n  <button class=\"banana-set-size\" role=\"button\">Banana</button>\n`;\n\n\nlet error = false;\n\nif (!(game.modules.get(\"sequencer\")?.active)) {\n    error = `You need to have Sequencer installed and activated to run this macro!`;\n}\nif (error) {\n    ui.notifications.error(error);\n    return;\n}\n\nconst macro = this;\nnew Dialog({\n    title: \"GURPS Instant Colored Borders\",\n    content: myContent,\n    buttons: {},\n    render: async (html) => listeners(html)\n}).render(true);\n\nasync function listeners(html) {\n    if (macro.getFlag(\"world\", \"sizes\")) html.find(\"#sizes\").val(macro.getFlag(\"world\", \"sizes\"));\n    else html.find(\"#sizes\").val(0);\n    html.click(async function (event) {\n        if (event.target.className === \"banana-set-size\") {\n            const size = html.find(\"#sizes\").val(); \n            const cor = html.find(\"#cores\").val(); \n            await macro.setFlag(\"world\", \"sizes\", size);\n            await aplica(size, cor);\n            html.find(\"#sizes\").val(size)\n        }\n    });\n}\nasync function aplica(size, cor) {\n    let token = canvas.tokens.controlled[0]\n    const effects = Sequencer.EffectManager.getEffects({\n        name: \"*bordinha*\",\n        object: token,\n    });\n    if (effects.length) {\n        console.log(\"removing effect\")\n        Sequencer.EffectManager.endEffects({ name: \"*bordinha*\", object: token });\n    }\n    else {\n        console.log(\"adding effect\", size, cor)\n        new Sequence()\n            .effect()\n            .file(`/modules/gurps-instant-defaults/packs/borders/${cor}.webm`)\n            .attachTo(token)\n            .scale(Number(size))\n            .atLocation(token)\n            .persist()\n            .name(\"bordinha\")\n            .elevation(0)\n            .play();\n    }\n}","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"world":{"sizes":"0.39","poder":{"foo":"$350","bar":"$540","zip":"$400"}},"gurps-instant-defaults":{"sizes":""},"core":{"sourceId":"Macro.S5hjkNBOiqdm8lmb"},"combat-utility-belt":{"macroTrigger":""}},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1665459890841,"modifiedTime":1669696547625,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"PQ2Y3q1o8l3H4ZUP"}
{"name":"Healing Tool","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/holy/chalice-glowing-gold-water.webp","scope":"global","command":"const targets = Array.from(game.user.targets);\n\n//MINOR HEALING\n\n\nfunction minorHealing(energy) {\n  if ((energy > 3)) {\n    ui.notifications.error(\"The value need to be equal or lower than 3\");\n    dialogEditor.render(true);\n        \n \n//  energy = Object.keys(energy).length === 0 {\n//       ui.notifications.error(\"Choose a value between 1-3\");\n      \n      \n\n    } else {\n      \n      \n      GURPS.executeOTF(`/r [/hp +${energy}  @target]`)\n      GURPS.executeOTF(`/r [/fp -${energy}]`)\n    }\n  }\n\n\n  //MAJOR HEALING\n\n\nfunction majorHealing(energy) {\n  if ((canvas.tokens.controlled[0] === 0 & Array.from(game.user.targets)[0] === 0)) {\n    ui.notifications.error(\"You need some energy to cast this spell!\");\n    dialogEditor.render(true);\n\n  } else {\n    let realHealing = energy * 2\n    targets.forEach((target) => {\n    GURPS.executeOTF(`/r [/hp +${realHealing}  @target]`)\n    GURPS.executeOTF(`/r [/fp -${energy}]`);\n    }\n    )};\n  \n\n}\n\n//GREATER HEALING\n\nfunction greaterHealing(energy) {\n\n  GURPS.executeOTF(`/r [/hp reset  @target]`)\n  GURPS.executeOTF(`/r [/fp -20]`)\n}\n\nlet dialogContent =\n` \n\n    <form>\n    <div class=\"form-group\">\n      <label>Fatigue Points:</label>\n      <input id=\"energy\" name=\"energy\" type=\"number\" value=\"1\" min=\"1\" max=\"20\">\n      </div>    \n`\n  ;\n\n//let applyChanges = false\nlet dialogButtons = {\n \n\n  minorHealing: {\n\n    label: `Minor Healing`,\n    callback: async (html) => minorHealing(html.find('#energy').val())\n  },\n  majorHealing: {\n\n    label: `Major Healing`,\n    callback: async (html) => majorHealing(html.find('#energy').val())\n  },\n  greaterHealing: {\n\n    label: `Greater Healing`,\n    callback: async (html) => greaterHealing(html.find('#energy').val())\n  }\n}\n\nlet dialogEditor = new Dialog({\n  title: `Instant Healings`,\n  content: dialogContent,\n  buttons: dialogButtons,\n  default: \"yes\",\n})\n\ndialogEditor.render(true);","flags":{"core":{"sourceId":"Macro.npfhk5aF2sMZi0Cg"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547622,"modifiedTime":1669696547622,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"Q6XVPWj1b7dcqMFa"}
{"name":"New Macro","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"GURPS.recurselist(GURPS.LastActor.system.equipment.carried, (e, key, d) => {\n\nconst formatter = new Intl.NumberFormat('de-DE', {\n  style: 'currency',\n  currency: 'EUR',\n})\n  if (e.name.includes(\"eddies\"))\n//total = e.cost * e.count\n\n\n\nChatMessage.create({\n        speaker: {alias: \"Banco de Night City\"},\n\n        content: `<p style=\"background-color: black;\n                            color: green;\n                            border-radius: 0px 18px 0px 18px;\n                            border-color: green;\n                            height: 100px;\n                            font-weight: 900;\n                            padding: 40px;\n                            border-width: 3px;\"> You have: \n\n                            <span style=\"\n                            font-weight: 1900;\n                            color: white;\">\n                            ${formatter.format(`${e.count}`)}$\n                </span>\n                  </p>`})\n})","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670010823190,"modifiedTime":1670034054389,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"S6p8Pvs1rUktIN1L"}
{"name":"#[CF_tempEntity]","type":"chat","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","scope":"global","command":"","flags":{"cf":{"id":"temp_pn0x3le0bx","name":"Macros","color":"#000000","fontColor":"#FFFFFF","icon":"","sorting":"m","contents":["cWucJTpypbC96DpL","b5jGz6Mg8DgHdPsu","gPfNLGhPZSb8ZK3I","iJg3vYslNj958o30","TVFAD9kLLT3nl2QG","fpm1y2KEbiCkJRSw","lPjmmtmgyqjK9vTR","yQqXRhLgMqGR8js4","g7bncwhoimLeaRQs","FGUPlNy6RMT7OBvx"],"children":[],"folderPath":[],"version":"2.4.7"},"core":{"sourceId":"Compendium.myUselessMacros.GURPS4E-Macro.3Xlz0rgOgRi2lJX7"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547621,"modifiedTime":1669696547621,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"SnpQkxZAKRawdYLr"}
{"name":"Journal Menu","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/tools/scribal/ink-quill-pink.webp","scope":"global","command":"const managerType = 'Journal Menu';\n\n(()=>{\n  const journals = [\n    \n    \"Vision\",\n    \"Escudo\"   \n\n  ];\n\n    let buttons = {}, dialog, content = `<div sytle=\"width:100%;text-align:center;><h2>Choose Journal</h2></div>`;\n  \n  \n  journals.forEach((str)=> {\n    let journal = game.journal.getName(str);\n    if(!journal) return;\n\n    buttons[str] = {\n      label : `\n        <div style=\"display:flex;flex-direction:row;justify-content:center;align-items:center;\">\n          \n        <div style=\"display:flex;justify-content:left;flex-grow:1;\">\n        \n          <source src=\"/sounds/pop.mp3\" type=\"audio/mpeg\">\n\n        <div style=\"display:flex;justify-content:left;flex-grow:1\"><label>${str}</label></div>\n        </div>`,\n      callback : () => {\n        game.journal.getName(str).sheet.render(true);\n       dialog.render(true);\n      }\n    }\n  });\n  dialog = new Dialog({title : `${managerType}`,content, buttons}).render(true);\n})();","flags":{"core":{"sourceId":"Macro.2mBXApLhSAET8wtI"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547623,"modifiedTime":1669696547623,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"UgkpRFYETNuhxfHP"}
{"name":"Fatigue","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/equipment/feet/boots-leather-laced-brown.webp","scope":"global","command":"/*\nOnly works in GURPS Game Aid.(how are you feeling now DnD'ers?)\nSelect your party e click to run the macro. The FP adjustmentes will be made based\non your actual encumbrance. When use it to calculate FP on Hiking, stop the hiking\nand recalculate when the first character is 1/3 FP.\nI hope you enjoy it!\n*/\nif (canvas.tokens.controlled.length === 0)\n  return ui.notifications.error(\"Select the tokens\");\n\n\n\nlet actors = canvas.tokens.controlled.map((i) => i.actor);\nif (!actors.length)\n  actors = game.users\n    .filter((i) => i.active && !!i.character)\n    .map((i) => i.character);\nfor (const actor of actors) {\n  const encumbrance = actor.system.encumbrance;\n  const FP = actor.system.FP;\n  const current = Object.values(encumbrance).find((i) => i.current);\n  const key = current.key;\n  const value = actor.system.FP.value;\n  if (key === \"enc0\") await actor.update({ \"data.FP.value\": value - 1 });\n  else if (key === \"enc1\") await actor.update({ \"data.FP.value\": value - 2 });\n  else if (key === \"enc2\") await actor.update({ \"data.FP.value\": value - 3 });\n  else if (key === \"enc3\") await actor.update({ \"data.FP.value\": value - 4 });\n  else if (key === \"enc4\") await actor.update({ \"data.FP.value\": value - 5 });\n  ChatMessage.create({content:  `<p>${actor.name} have <b>${FP.value} FP</b></p>`});\n}","flags":{"core":{"sourceId":"Macro.E2P570JwpoQEoRPl"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547624,"modifiedTime":1669696547624,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"Y2fZDdbuWuIzXswL"}
{"name":"Contacts","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/environment/people/commoner.webp","command":"const myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/contact.html\");\n\nnew Dialog({\n  title: \"GURPS Instant Contacts\",\n  content: myContent,\n  buttons: {}\n}).render(true);","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"combat-utility-belt":{"macroTrigger":""},"core":{"sourceId":"Macro.pFxphiDbyADKXuKC"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1668276798922,"modifiedTime":1669696547620,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"YlSzCYdeIdNjZjLR"}
{"name":"Random picker","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/skills/targeting/crosshair-pointed-orange.webp","command":"//select a bunch of tokens and execute macro.\n\n\nconst tokens = canvas.tokens.controlled;\nconst rand = Math.floor(Math.random() * tokens.length);\nconst name = tokens[rand].document.name;\nconst image = tokens[rand].document.texture.src;\nChatMessage.create({\n content: \"<div style='font-size: 1.8em; margin: 1em 0; text-align: center;'><img src='\" + image + \"' style='max-width:6em;border:none;'><br>\" + name + \"</div>\",\n whisper: [game.user.id]\n});","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.A5N2tK8oKLorO4iM"},"combat-utility-belt":{"macroTrigger":""}},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1666902698419,"modifiedTime":1670264383991,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"YxSbQmp4OCLOkuxH"}
{"name":"Sight Adjustment","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/skills/targeting/crosshair-arrowhead-blue.webp","scope":"global","command":"/*\nSelect all tokens to change the size of sight.\nClick on Macro with:\n\nCtrl  = Increase Sight +1\nAlt = decrease Sight -1\n\nOnly Click in the macro you will change your sight by 0\n\n*/\n\n\nconst updates = canvas.tokens.controlled.map(i => {\n  const dimSight = Number(i.document.sight.range);\n  const change = event.ctrlKey ? dimSight + 0.8 : event.altKey ? dimSight -1 : 0;\n  return {_id: i.id, dimSight: Math.max(change, 0)};\n});\nawait canvas.scene.updateEmbeddedDocuments(\"Token\", updates);","flags":{"core":{"sourceId":"Macro.x4SKjhUyWSJeecrz"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1664843591301,"modifiedTime":1669696547622,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"aV4XLgmciSv50a1m"}
{"name":"Falling Calculator","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/skills/movement/arrow-down-pink.webp","scope":"global","command":"if (canvas.tokens.controlled.length === 0)\n  return ui.notifications.error(\"Select the falling token\");\n\n\n\nconst myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/falling.html\");\n\nnew Dialog({\n  title: \"GURPS Instant Falling Damage\",\n  content: myContent,\n  buttons: {}\n}).render(true);","flags":{"core":{"sourceId":"Macro.edXnzxry3c8iIM2p"},"cf":{"id":"temp_etvk8gr4cam"},"combat-utility-belt":{"macroTrigger":""}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547621,"modifiedTime":1669696547621,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"ausDr2K1wDsAvlLP"}
{"name":"Resize","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/movement/chevrons-down-yellow.webp","command":"let tokens = canvas.tokens.controlled\ntokens.forEach(t => {\n    if (token.data.width<1)\n        t.document.update({\"width\": 1, \"height\": 1});\n    else if (token.data.width>=1)\n        t.document.update({\"width\": .5, \"height\": .5});\n})","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.78ZavNQFxJKwjqLU"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1665527251394,"modifiedTime":1669696547621,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"bsM8cFewrYOxNaj2"}
{"name":"#[CF_tempEntity]","type":"chat","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","scope":"global","command":"","flags":{"cf":{"id":"temp_etvk8gr4cam","name":"Calculator","color":"#000000","fontColor":"#FFFFFF","icon":"","sorting":"m","contents":["XZvgTKh2xPf98cLO","czLsLxFhGA2mgRHy","KF8VDAY7IXYeOFSu","24HQWV0CIGZXECT1","Rut3d9IplQu7Mstj","m4bgVALDKeqxZnNS","IoLnQV0YIxa0d8pb"],"children":[],"folderPath":[],"version":"2.5.3"},"core":{"sourceId":"Compendium.myUselessMacros.GURPS4E-Macro.ZTZZ2SJ2HKynNflz"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547622,"modifiedTime":1669696547622,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"ddDYdO2aDMvHFOv5"}
{"name":"Body Parts","type":"script","author":"mW8b5k19Zu6i2R2v","img":"modules/gurps-instant-defaults/img/icons/bodyParts/face.png","scope":"global","command":"const managerType = \"Body Parts\";\n\n(() => {\n  const tables = [\n    \"Abdomen\",\n    \"Arm\",\n    \"Chest\",\n    \"Face\",\n    \"Foot\",\n    \"Hand\",\n    \"Leg\",\n    \"Neck\"\n     ];\n\n  let buttons = {},\n    dialog,\n    content = `<div sytle=\"display:flex;text-align:center;><h2>Choose Macro</h2></div>`;\n\n\n  tables.forEach((str) => {\n    let table = game.tables.getName(str);\n    if (!table) return;\n\n    buttons[str] = {\n      label: `\n       \n<style>\n#bp .window-content {\n    background-image: url('systems/gurps/icons/hex2.webp');\n        background-color: #353434;\n        display: inline-block;\n          width: 100%;\n\n\n  }\n\n  \n\n  #bp header {\n    font-family: Roboto;\n    background-color: #353434;\n    border-radius: 0;\n    border: none;\n    margin-bottom: 2px;\n    font-size: .75rem;\n  }\n\n#bp .dialog-button {\n  border: 1px solid #18181a;\n  color: #18181a;\n  font-size: 15px;\n  line-height: 15px;\n  padding: 5px 5px 5px;\n  width: 100%;\n  height: 100%;\n  cursor: cell;\n  background: #807f7f;\n  border-radius: 18px;\n  margin-bottom: 2px;\n      }\n\n    #bp .dialog-button:hover {\n  background-color: #353434; /* Green */\n  color: white;\n    box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19);\n    }\n\n      </style> \n         <div style=\"display:flex;flex-direction:row;justify-content:center;align-items:center;\">\n          \n        <div style=\"display:flex;justify-content:left;flex-grow:1;\">\n        <img src=\"${table.img}\" width=\"50\" height=\"50\" style=\"background-color:#5c5c5c;;border-radius: 10px;margin: 3px 3px 3px;\"/></div>\n          <source src=\"/sounds/pop.mp3\" type=\"audio/mpeg\">\n\n        <div style=\"display:flex;justify-content:left;flex-grow:1\"><label>${str}</label></div>\n        </div>\n        \n        \n        \n        \n        \n        \n        \n        \n        \n        \n        \n        `,\n      callback: () => {\n        game.tables.getName(str).draw();\n        dialog.render(true);\n      },\n    };\n  });\n  dialog = new Dialog(\n    { title: `${managerType}`, content, buttons },\n    { id: \"bp\" }\n  ).render(true);\n})();","flags":{"core":{"sourceId":"Macro.bLIEcmBOaxoJl7yO"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547623,"modifiedTime":1669696547623,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"fDRqOMS9bjXzklNo"}
{"name":"Caesar's Cipher","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/sundries/gaming/dice-runed-brown.webp","scope":"global","command":"const myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/cripto.html\");\n\nnew Dialog({\n  title: \"GURPS\",\n  content: myContent,\n  buttons: {}\n}, { id: 'cypher'}).render(true);","flags":{"core":{"sourceId":"Macro.OUICocE2cU8t69eO"},"cf":{"id":"temp_etvk8gr4cam"},"combat-utility-belt":{"macroTrigger":""}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547623,"modifiedTime":1669696547623,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"fWZpIpraFbgH8RWa"}
{"name":"Sight Toggle","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/perception/shadow-stealth-eyes-purple.webp","scope":"global","command":"if (canvas.tokens.controlled.length === 0)\n  return ui.notifications.error(\"Select your token token\");\n\nawait token.document.update({sightAngle : token.document.sight.angle === 360 ? 275 : 360});","flags":{"core":{"sourceId":"Macro.kRKbNVaRiRhyjZOD"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1664843588971,"modifiedTime":1669696547625,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"iFyJBTGtcraM5HgT"}
{"name":"New Macro","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"const myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/teste.html\");\n\nnew Dialog({\n  title: \"GURPS Instant Contacts\",\n  content: myContent,\n  buttons: {}\n}).render(true);","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.290","createdTime":1670001189528,"modifiedTime":1670001230148,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"kvUZskEx5GoNkv0d"}
{"name":"First Aid Calculator","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/life/heart-glowing-red.webp","scope":"global","command":"const myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/firstAid.html\");\n\nnew Dialog({\n  title: \"GURPS\",\n  content: myContent,\n  buttons: {}\n}).render(true);","flags":{"core":{"sourceId":"Macro.eiBOlcjpYF6WwZ5M"},"cf":{"id":"temp_etvk8gr4cam"},"combat-utility-belt":{"macroTrigger":""}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547621,"modifiedTime":1669696547621,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"mLxvvKASA0LpAK5a"}
{"name":"achar coisas","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"//Verifica o bônus e a dificuldade\nlet applyChanges = false;\nnew Dialog({\n  title: `Teste de Força`,\n  content: `\n    <form>\n    \n    <div class=\"form-group\">\n        <label>Dificuldade:</label>\n        <select id=\"dificuldade\" name=\"dificuldade\">\n          <option value=\"4\">Fácil (4)</option>\n          <option value=\"5\">Normal (5)</option>\n          <option value=\"6\">Difícil (6)</option>\n        </select>\n      </div>\n      \n      <div class=\"form-group\">\n        <label>Bônus:</label>\n        <input type=\"number\" id=\"bonus\" name=\"bonus\" value=0>\n      </div>\n      \n    </form>\n    `,\n  buttons: {\n    yes: {\n      icon: \"<i class='fas fa-check'></i>\",\n      label: `Aplicar`,\n      callback: () => applyChanges = true\n    },\n    no: {\n      icon: \"<i class='fas fa-times'></i>\",\n      label: `Cancelar`\n    },\n  },\n  default: \"yes\",\n  close: html => {\n    if (applyChanges) {\n      for ( let token of canvas.tokens.controlled ) {\n      \n     \n      let dificuldade = parseInt(html.find('[name=\"dificuldade\"]')[0].value || \"none\");\n      let bonus = parseInt(html.find('[name=\"bonus\"]')[0].value || \"none\");\n      let forca = token.actor.system.attributes.atr.atr1_for.value;\n      \nnew Roll(`${1 + forca + bonus}d6kh1cs>=${dificuldade}`).toMessage({flavor: \"TESTE DE FORÇA\"})\n\nif (Roll>= dificuldade) {ChatMessage.create({content: `SUCESSO`}) }\n\nelse {ChatMessage.create({content: `FRACASSO`})}\n\n      }\n    }\n  }\n}).render(true);","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670232883241,"modifiedTime":1670259590111,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"oK2i2eeLdW71adwZ"}
{"name":"#[CF_tempEntity]","type":"chat","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","scope":"global","command":"","flags":{"cf":{"id":"temp_58ibxbr8cng","name":"Tables","color":"#000000","fontColor":"#FFFFFF","icon":"","sorting":"m","contents":["z1H3yBmWLs3TFTbt","T4lat5EDOgrcJ3vP"],"children":[]},"core":{"sourceId":"Compendium.myUselessMacros.GURPS4E-Macro.QnA9iTItTiNFCEi9"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547622,"modifiedTime":1669696547622,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"pUk8bV1LcojyXZ3R"}
{"name":"Draw Walls","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/environment/settlement/city-wall.webp","command":"let drawings = canvas.drawings.controlled;\n\nif (!drawings.length) return ui.notifications.warn(\"No Drawings\");\ndrawings = drawings.map(drawing => {\n    console.log(drawing.document);\n    switch (drawing.document.shape.type) {\n        case \"f\":\n        case \"p\": {\n            let { id, rotation, x, y  } = drawing.document;\n            let { width, height , points} = drawing.document.shape;\n            points = points.reduce((a,x,i)=> {\n              if((i+2)%2) a[Math.floor(i/2)].push(x);\n              else a.push([x]);\n              return a;\n            }, []);\n            return { id, valid: true, points, rotation, x, y, width, height };\n        }\n        case \"r\": {\n            let { id, rotation, x, y  } = drawing.document;\n            let { width, height } = drawing.document.shape;\n            const points = [\n                [0, 0],\n                [width, 0],\n                [width, height],\n                [0, height],\n                [0, 0],\n            ];\n            return { id, valid: true, points, rotation, x, y, width, height };\n        }\n        case \"e\": {\n            let { id, rotation, x, y  } = drawing.document;\n            let { width, height} = drawing.document.shape;\n            let size = (height>width?height:width)/canvas.grid.size*60;\n            let segmentCount = Math.max(Math.ceil(Math.sqrt(size/2)), 4);\n            let step = 2*Math.PI/segmentCount;  // see note 1\n            let h = drawing.center.x-x;\n            let k = drawing.center.y-y;\n            let r = width/2;\n            let t = height/width;\n            let points = [];\n            let segment = [];\n            let start = [];\n            for(let theta=0;  theta < 2*Math.PI;  theta+=step) { \n              let x = h +     r*Math.cos(theta);\n              let y = k - t * r*Math.sin(theta); \n              \n               if (theta==0) \n                start = [Math.round(x), Math.round(y)];\n              \n              points.push([Math.round(x),Math.round(y)]);\n              \n              if (segment.length > 2)\n               points.push(segment.map(p=>p))\n            }\n            points.push(start)\n            return { id, valid: true, points, rotation, x, y, width, height };\n          }\n        default:\n            return { id: drawing.data._id, valid: false }; \n    }\n}).filter(drawing => {\n    if (!drawing.valid) {\n        ui.notifications.warn(`Drawing \"${drawing.id}\" is not a valid drawing type`);\n        return false;\n    }\n    return true;\n});\n\n//console.log(\"drawings\", drawings)\n    const newWalls = drawings.flatMap((drawing) => {\n        const { x, y, width, height } = drawing;\n        const xCenterOffset = width/2;\n        const yCenterOffset = height/2;\n        \n        const θ = Math.toRadians(drawing.rotation);\n        const cosθ = Math.cos(θ);\n        const sinθ = Math.sin(θ);\n        \n        const points = drawing.points.map((point) => {\n            const offsetX = point[0] - xCenterOffset;\n            const offsetY = point[1] - yCenterOffset;\n            const rotatedX = (offsetX * cosθ - offsetY * sinθ);\n            const rotatedY = (offsetY * cosθ + offsetX * sinθ);\n            //console.log( x, y, width, height, offsetX, offsetY, rotatedX, rotatedY, xCenterOffset, yCenterOffset);\n            return [rotatedX + x + xCenterOffset, rotatedY + y + yCenterOffset];\n            \n        });\n        //console.log(points)\n        \n        return points\n            .slice(0, points.length - 1)\n            .map((point, i) => ({ c: point.concat(points[i + 1]) }));\n    });\n    //console.log(drawings, newWalls);\n    canvas.scene.createEmbeddedDocuments(\"Wall\", newWalls);\n    canvas.walls.activate();","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670095991221,"modifiedTime":1670257956823,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"q8DU3gyMbvtRBgxB"}
{"name":"Compendium Menu","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/sundries/books/book-embossed-blue.webp","scope":"global","command":"const managerType = 'Compendium Menu';\n\n(()=>{\n  const journals = [\n    \n    \"gurps-instant-defaults.GURPS4E-Basic-Set\" , \n    \"GURPS-Modifier-Tables.tables\",\n    \"gurps-instant-defaults.GURPS4E-Dungeon-Fantasy-RPG\",\n    \"GURPS RollTables\"\n   \n\n  ];\n\n  let path = 'icons/sundries/books/',\nfiles = [\n    'book-backed-silver-gold.webp', \n    'book-worn-brown-grey.webp',\n     'book-worn-blue.webp',\n      'book-symbol-canterbury-cross.webp',\n       'book-symbol-triangle-silver-purple.webp',\n        'book-tooled-silver-blue.webp',\n         'book-symbol-fire-gold-orange.webp',\n          'book-stack.webp',\n           'book-embossed-spiral-purple-white.webp',\n            'book-symbol-leaf-green.webp']\ni = Math.floor(Math.random()*files.length);\nlet imagem = (path+files[i]);\nconsole.log(imagem)\n\n    let buttons = {}, dialog, content = `<div sytle=\"width:100%;text-align:center;><h2>Choose Journal</h2></div>`;\n  \n  \n  journals.forEach((str)=> {\n    let journal = game.packs.get(str);\n    if(!journal) return;\n    const name = journal.metadata.label;\n\n    buttons[str] = {\n      label : `\n        <div style=\"display:flex;flex-direction:row;justify-content:center;align-items:center;\">\n          \n        <div style=\"display:flex;justify-content:left;flex-grow:1;\">\n        \n        <img src=\"${imagem}\" width=\"50\" height=\"50\" style=\"background-color:#5c5c5c;;border-radius: 10px;margin: 3px 3px 3px;\"/></div>\n\n        <div style=\"display:flex;justify-content:left;flex-grow:1\"><label>${name}</label></div>\n        </div>`,\n      callback : () => {\n        game.packs.get(str).render(true);\n       dialog.render(true);\n      }\n    }\n  });\n  dialog = new Dialog({title : `${managerType}`,content, buttons}).render(true);\n})();","flags":{"core":{"sourceId":"Macro.qsWPXt5DBqz5Yis1"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547624,"modifiedTime":1669696547624,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"wyNigTPiNMYjTunO"}
{"name":"Bet on it","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/sundries/gaming/playing-cards.webp","scope":"global","command":"const myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/gambling2.html\");\n\nnew Dialog({\n  title: \"GURPS\",\n  content: myContent,\n  buttons: {}\n}, { id: 'gambling'}).render(true);","flags":{"core":{"sourceId":"Macro.Uudkyh1b9ZGrjvvH"},"cf":{"id":"temp_etvk8gr4cam"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547622,"modifiedTime":1669696547622,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"xd9cFMkOzEQTdXE1"}
{"name":"New Macro","type":"chat","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.290","createdTime":1670001778378,"modifiedTime":1670001778378,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"z12CMQMGyQbq4eJa"}
{"name":"New Macro","type":"chat","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670267152153,"modifiedTime":1670267152153,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"3QnWN2J9ylHqsxJy"}
{"name":"New Macro","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"const content = `\n<form>\n    <div class=\"form-group\">\n        <label>Dice Roll:</label>\n        <div class=\"form-fields\">\n            <input name=\"formula\" type=\"text\" value=\"1d20\">\n        </div>\n    </div>\n    <div class=\"form-group\">\n        <label>Desired Result:</label>\n        <div class=\"form-fields\">\n            <input name=\"outcome\" type=\"number\" value=\"20\">\n        </div>\n    </div>\n</form>\n`;\n\n\nnew Dialog({\n    title: \"loaded dice dialog\",\n    content,\n    buttons:{\n        roll: {\n            label: \"Roll!\",\n            callback: cheatingDiceRoll\n        }\n    }\n}).render(true);\n\n\n// lets see if we can make this for any dice amount...\nasync function cheatingDiceRoll(html) {\n    const formula = html.find(\"[name=formula]\").val();\n    const desired = Number(html.find(\"[name=outcome]\").val());\n    let roll = await new Roll(formula).evaluate();\n    let diceDifference = desired - roll.total;\n    let modifierTotal = roll.total - roll.dice.reduce((acc, e)=> acc += e.total, 0);\n    const maxEyes = roll.dice.reduce((acc, e)=> acc += e.faces * e.number, 0);\n    const minEyes = roll.dice.reduce((acc, e)=> acc += e.number, 0);\n    if(desired < minEyes + modifierTotal || desired > maxEyes + modifierTotal) return ui.notifications.warn(\"Your cheated number is outside the range of possibility\");\n    while (diceDifference !== 0) {\n        const dice = roll.terms.filter(e => e instanceof CONFIG.Dice.termTypes.DiceTerm);\n        const change = diceDifference > 0 ? -1 : 1;\n        for(let die of dice) {\n            for(let result of die.results){\n                if((result.result === 1 && change === 1) || (result.result === die.faces && change === -1) || diceDifference === 0) continue;\n                result.result -= change;\n                diceDifference += change;\n            }\n        }\n    }\n    roll._total = desired;\n    await roll.toMessage();\n}","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670267152153,"modifiedTime":1670267155897,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"3QnWN2J9ylHqsxJy"}
{"name":"New Macro","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"const wait = (delay) => new Promise((resolve) => setTimeout(resolve, delay));\nasync function imageMessage(html, mode) {\n    const url = html.find(\"[name=url]\")[0].value;\n    if (url === \"\") {\n        return;\n    }\n    if (mode == \"chat\") {\n        const messageContent = `<img src=\"${url}\" />`;\n        const checked = html.find(\"[name=whisper]\")[0].checked;\n        if(!checked) {\n            await ChatMessage.create({content: messageContent});\n            return;\n        }\n        const playerId = html.find(\"[name=player]\")[0].value;\n        const playerName = game.users.get(playerId).data.name;\n        await ChatMessage.create({content: messageContent, whisper: ChatMessage.getWhisperRecipients(playerName)})\n    }\n    if (mode == \"popout\"){\n        const popout = new ImagePopout(url).render(true);\n        popout.shareImage();\n    }\n\n}\n(async () => {\n    let dialogOptions = game.users.filter(u => u.data.role < 3).map(u => `<option value=${u.id}> ${u.data.name} </option>`).join(``);\n    \n    \n    let dialogContent = `\n                        <div><h2>Paste your image url below:</h2><div>\n                        <div>URL: <input name=\"url\" style=\"width:350px\"/></div>\n                        <div><i>if the image is from the internet do not forget to include http(s):// in the url</i></div>\n                        <div>Whisper to player?<input name=\"whisper\" type=\"checkbox\"/></div>\n                        <div\">Player name:<select name=\"player\" disabled>${dialogOptions}</select></div>\n                        `;\n    let d = new Dialog({\n        title: \"Image to Chat\",\n        content: dialogContent,\n        buttons: {\n            done: {\n                label: \"Send to Chat!\",\n                callback: (html) => {\n                    imageMessage(html, \"chat\");\n                }\n            },\n            show: {\n                label: \"Show pop out!\",\n                callback: (html) => {\n                    imageMessage(html, \"popout\");\n                }\n            }\n        },\n        default: \"done\"    \n    })\n    d.render(true)\n    await wait(50)\n    $(document).ready(function() {\n        $(\"[name=whisper]\").change(function () {\n            if($(\"[name=player]\").attr(\"disabled\")){\n                $(\"[name=player]\").removeAttr(\"disabled\")\n            }\n            else {\n               $(\"[name=player]\").attr(\"disabled\", true)  \n            }\n        });\n    });\n})();","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670267152153,"modifiedTime":1670267377952,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"3QnWN2J9ylHqsxJy"}
{"$$deleted":true,"_id":"3QnWN2J9ylHqsxJy"}
{"name":"New Macro","type":"chat","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670267769350,"modifiedTime":1670267769350,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"AxhIKnwfRyItjnJG"}
{"name":"New Macro","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"//v10 macro: (remove the commented out text below if you are using v10, see instructions below for v9)\nasync function moveX(direction, fine) {\n    let distance = fine ? 1 : 10;\n    distance = direction == \"left\" ? (distance * (-1)) : distance;\n    const tilesToMove = canvas.tiles.controlled ;\n    const updates = tilesToMove.map(tile => ({\n        _id: tile.id,\n        x: tile.document.x + distance\n    }));\n    await canvas.scene.updateEmbeddedDocuments(\"Tile\", updates);\n}\n\nasync function moveY(direction, fine) {\n    let distance = fine ? 1 : 10;\n    distance = direction == \"up\" ? (distance * (-1)) : distance;\n    const tilesToMove = canvas.tiles.controlled;\n    const updates = tilesToMove.map(tile => ({\n        _id: tile.id,\n        y: (tile.document.y + distance)\n    }));\n    await canvas.scene.updateEmbeddedDocuments(\"Tile\", updates);\n}\n\nasync function rotate(direction, fine) {\n    let updates = [];\n    if(direction !== \"rotate-reset\") {\n        let increment = fine ? 5 : 45;\n        increment = direction === \"rotate-right\" ? increment : increment * -1;\n        const tilesToMove = canvas.tiles.controlled;\n        updates = tilesToMove.map(tile => ({\n            _id: tile.id,\n            rotation: (tile.document.rotation + increment)%360\n        }));\n    }\n    else {\n        const tilesToMove = canvas.tiles.controlled;\n        updates = tilesToMove.map(tile => ({\n            _id: tile.id,\n            rotation: 0\n        }));  \n    }\n    await canvas.scene.updateEmbeddedDocuments(\"Tile\", updates);\n}\n\nasync function handleEvents(html) {\n    html.find(\"a.direction-button\").click(function(){\n        const fine = html.find(\"input[name=control]\")[0].checked;\n        if(this.dataset.direction.includes(\"rotate\")) rotate(this.dataset.direction, fine);\n        else if(this.dataset.direction === \"up\" || this.dataset.direction === \"down\" ) moveY(this.dataset.direction, fine);\n        else moveX(this.dataset.direction, fine);\n    });\n}\n\nconst style = `<style>\n    #tile-mover-dialog .direction-button-box{\n        display: flex;\n        justify-content: space-evenly;\n    }\n    #tile-mover-dialog .direction-button {\n            font-size: 2em;\n            text-align: center;\n            width: 60px;\n            height: 40px;\n            background-color: #bdbdbd8f;\n            border-radius: 3px;\n            line-height: 40px;\n            border: 2px groove var(--color-border-light-highlight);\n    }\n</style>`;\n\nconst content = style + `<fieldset><legend>Move</legend><div class=\"direction-button-box\">\n    <a class=\"direction-button\" data-direction=\"left\"><i class=\"fas fa-long-arrow-alt-left\"></i></a>\n    <a class=\"direction-button\" data-direction=\"up\"><i class=\"fas fa-long-arrow-alt-up\"></i></a>\n    <a class=\"direction-button\" data-direction=\"down\"><i class=\"fas fa-long-arrow-alt-down\"></i></a>\n    <a class=\"direction-button\" data-direction=\"right\"><i class=\"fas fa-long-arrow-alt-right\"></i></a>\n</div></fieldset>\n<hr>\n<fieldset><legend>Rotate</legend><div class=\"direction-button-box\">\n    <a class=\"direction-button\" data-direction=\"rotate-left\"><i class=\"fas fa-undo\"></i></a>\n    <a class=\"direction-button\" data-direction=\"rotate-reset\"><i class=\"fab fa-creative-commons-zero\"></i></a>\n    <a class=\"direction-button\" data-direction=\"rotate-right\"><i class=\"fas fa-redo\"></i></a>\n</div></fieldset>\n<hr>\n<form>\n    <div class=\"form-group\">\n        <label>Fine control?</label>\n        <div class=\"form-fields\">\n            <input name=\"control\" type=\"checkbox\" checked/>\n        </div>\n    </div>\n    <p>Fine <i class=\"fas fa-arrows-alt\"></i>: 1 pixel, <i class=\"fas fa-redo\"></i>: 5 degrees</p>\n    <p>Normal <i class=\"fas fa-arrows-alt\"></i>: 10 pixels, <i class=\"fas fa-redo\"></i>: 45 degrees</p>\n</form>\n<hr>`;\n\nlet d = new Dialog({\n    title: \"Tile mover\",\n    content,\n    buttons: {\n        close: {\n            label: \"Close\"\n        }\n    },\n    render: handleEvents\n},\n{\n    width: 280,\n    id: \"tile-mover-dialog\"\n});\n\nd.render(true);\n\n\n\n\n////////////for using it in v9, remove above code and then remove the /* and */ from around the code below////////////////\n// v9 macro\n/*\nasync function moveX(direction, fine) {\n    let distance = fine ? 1 : 10;\n    distance = direction == \"left\" ? (distance * (-1)) : distance;\n    const tilesToMove = canvas.background.controlled.length ? canvas.background.controlled : canvas.foreground.controlled;\n    const updates = tilesToMove.map(tile => ({\n        _id: tile.id,\n        x: (tile.data.x + distance)\n    }));\n    await canvas.scene.updateEmbeddedDocuments(\"Tile\", updates);\n}\n\nasync function moveY(direction, fine) {\n    let distance = fine ? 1 : 10;\n    distance = direction == \"up\" ? (distance * (-1)) : distance;\n    const tilesToMove = canvas.background.controlled.length ? canvas.background.controlled : canvas.foreground.controlled;\n    const updates = tilesToMove.map(tile => ({\n        _id: tile.id,\n        y: (tile.data.y + distance)\n    }));\n    await canvas.scene.updateEmbeddedDocuments(\"Tile\", updates);\n}\n\nasync function rotate(direction, fine) {\n    let updates = [];\n    if(direction !== \"zero\") {\n        let increment = fine ? 5 : 45;\n        increment = direction === \"cw\" ? increment : increment * -1;\n        const tilesToMove = canvas.background.controlled.length ? canvas.background.controlled : canvas.foreground.controlled;\n        updates = tilesToMove.map(tile => ({\n            _id: tile.id,\n            rotation: (tile.data.rotation + increment)%360\n        }));\n    }\n    else {\n        const tilesToMove = canvas.background.controlled.length ? canvas.background.controlled : canvas.foreground.controlled;\n        updates = tilesToMove.map(tile => ({\n            _id: tile.id,\n            rotation: 0\n        }));  \n    }\n    await canvas.scene.updateEmbeddedDocuments(\"Tile\", updates);\n}\n\nasync function handleEvents(html) {\n    html.find(\"a.direction-button\").click(function(){\n        const fine = html.find(\"input[name=control]\")[0].checked;\n        if(this.className.includes(\"move-right\"))   moveX(\"right\", fine);\n        if(this.className.includes(\"move-left\"))    moveX(\"left\",  fine);\n        if(this.className.includes(\"move-up\"))      moveY(\"up\",    fine);\n        if(this.className.includes(\"move-down\"))    moveY(\"down\",  fine);\n        if(this.className.includes(\"rotate-right\")) rotate(\"cw\",   fine);\n        if(this.className.includes(\"rotate-left\"))  rotate(\"acw\",  fine);\n        if(this.className.includes(\"rotate-reset\")) rotate(\"zero\", fine);\n    });\n}\nconst style = `<style>\n    #tile-mover-dialog .direction-button-box{\n        display: flex;\n        justify-content: space-evenly;\n    }\n    #tile-mover-dialog .direction-button {\n            font-size: 2em;\n            text-align: center;\n            width: 60px;\n            height: 40px;\n            background-color: #bdbdbd8f;\n            border-radius: 3px;\n            line-height: 40px;\n            border: 2px groove var(--color-border-light-highlight);\n    }\n</style>`;\n\nconst content = style + `<fieldset><legend>Move</legend><div class=\"direction-button-box\">\n    <a class=\"direction-button move-left\"><i class=\"fas fa-long-arrow-alt-left\"></i></a>\n    <a class=\"direction-button move-up\"><i class=\"fas fa-long-arrow-alt-up\"></i></a>\n    <a class=\"direction-button move-down\"><i class=\"fas fa-long-arrow-alt-down\"></i></a>\n    <a class=\"direction-button move-right\"><i class=\"fas fa-long-arrow-alt-right\"></i></a>\n</div></fieldset>\n<hr>\n<fieldset><legend>Rotate</legend><div class=\"direction-button-box\">\n    <a class=\"direction-button rotate-left\"><i class=\"fas fa-undo\"></i></a>\n    <a class=\"direction-button rotate-reset\"><i class=\"fab fa-creative-commons-zero\"></i></a>\n    <a class=\"direction-button rotate-right\"><i class=\"fas fa-redo\"></i></a>\n</div></fieldset>\n<hr>\n<form>\n    <div class=\"form-group\">\n        <label>Fine control?</label>\n        <div class=\"form-fields\">\n            <input name=\"control\" type=\"checkbox\" checked/>\n        </div>\n    </div>\n    <p>Fine <i class=\"fas fa-arrows-alt\"></i>: 1 pixel, <i class=\"fas fa-redo\"></i>: 5 degrees</p>\n    <p>Normal <i class=\"fas fa-arrows-alt\"></i>: 10 pixels, <i class=\"fas fa-redo\"></i>: 45 degrees</p>\n</form>\n<hr>`;\n\nlet d = new Dialog({\n    title: \"Tile mover\",\n    content,\n    buttons: {\n        close: {\n            label: \"Close\"\n        }\n    },\n    render: handleEvents\n},\n{\n    width: 280,\n    id: \"tile-mover-dialog\"\n});\n\nd.render(true);\n*/","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670267769350,"modifiedTime":1670267773186,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"AxhIKnwfRyItjnJG"}
{"name":"New Macro","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"/**\n * Examples taken from from VanceCole's repository\n * Basic structure of the Dialog (from the API, with added optional object)\n */\nconst d = new Dialog({\n    title: \"Test Dialog\",\n    content: \"<p>You must choose either Option 1, or Option 2</p>\",\n    buttons: {\n        one: {\n            icon: '<i class=\"fas fa-check\"></i>',\n            label: \"Option One\",\n            callback: () => console.log(\"Chose One\")\n        },\n        two: {\n            icon: '<i class=\"fas fa-times\"></i>',\n            label: \"Option Two\",\n            callback: () => console.log(\"Chose Two\")\n        }\n    },\n    default: \"two\",\n    render: html => console.log(\"Register interactivity in the rendered dialog\"),\n    close: html => console.log(\"This always is logged no matter which option is chosen\")\n}, {\n    // optional object nothing here is needed to make a basic dialog work.\n    id: \"my-unique-id-for-this-dialog\", // name as you want just make it unique and no spaces! needed for CSS selecting if you add a <style> </style> to the content.\n    classes: [\"dialog\", \"stuff\", \"etc\"], // as with id.\n    width: 300, // default \"auto\" and cant go narrower than 200\n    height: 600, // default \"auto\"\n    resizable: true, // default false\n    top: 100, // location on screen where the top of the dialog sits, default is in the center of the screen\n    left: 100, // location on screen where the left of the dialog sits, default is in the center of the screen\n});\nd.render(true);\n\n\n/**\n * Premade simple dialog with a return value.\n * after user clicks button, confirmation will be boolean for yes/no\n */\nlet confirmation = await Dialog.confirm({\n    title: 'Example Confirm',\n    content: `<p>Are you sure?</p>`,\n});\n\n\n/**\n * Very simple dialog to request a user input returns the user input as a string.\n */\nlet myValue = await Dialog.prompt({\n    content: `<input type=\"text\">`,\n    callback: (html) => html.find('input').val()\n});\n\n\n/**\n * Example dialog that requests user input, then uses the value\n */\nlet d = new Dialog({\n    title: 'Example',\n    content: `\n        <form class=\"flexcol\">\n            <div class=\"form-group\">\n                <label for=\"exampleInput\">Example Input</label>\n                <div class=\"form-fields\">\n                    <input type=\"text\" name=\"exampleInput\" placeholder=\"Enter Value\">\n                </div>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"exampleSelect\">Example Select</label>\n                <div class=\"form-fields\">\n                    <select name=\"exampleSelect\">\n                        <option value=\"option1\">Option One</option>\n                        <option value=\"option2\">Option Two</option>\n                        <option value=\"option3\">Option Three</option>\n                    </select>\n                </div>\n            </div>\n            <div class=\"form-group\">\n                <label for=\"exampleColor\">Example Color</label>\n                <div class=\"form-fields\">\n                    <input class=\"color\" type=\"text\" name=\"exampleColor\" value=\"#ff6400\">\n                    <input type=\"color\" value=\"#ff6400\" data-edit=\"exampleColor\">\n                </div>\n            </div>\n            <div class=\"form-group\">\n                <textarea name=\"exampleText\" placeholder=\"Enter Text\"></textarea>\n            </div>\n      </form>\n    `,\n    buttons: {\n        no: {\n            icon: '<i class=\"fas fa-times\"></i>',\n            label: 'Cancel'\n        },\n        yes: {\n            icon: '<i class=\"fas fa-check\"></i>',\n            label: 'Yes',\n            callback: (html) => {\n                let input = html.find('[name=\"exampleInput\"]').val();\n                let select = html.find('[name=\"exampleSelect\"]').val();\n                let color = html.find('[name=\"exampleColor\"]').val();\n                let text = html.find('[name=\"exampleText\"]').val();\n                console.log(input, select, color, text);\n            }\n        },\n    },\n    default: 'yes',\n    close: () => {\n        console.log('Example Dialog Closed');\n    }\n});\nd.render(true)\n\n\n/**\n * Dialog that re-renders (stays open) when button is clicked\n * rather than closing\n */\nlet myContent = function (val) {\n    return `\n    <div class=\"main\">\n        <div class=\"headline\">\n            Attack information:\n        </div>\n        <div class=\"plain-text\">\n            <div class=\"actor\" id=\"currentActor\">${val}</div>\n        </div>\n    </div>\n    `;\n}\n\nlet myDialog = new Dialog({\n    title: `Example Dialog`,\n    content: myContent('Default Value'),\n    buttons: {\n        update: {\n            label: \"Update\",\n            callback: () => {\n                myValue = `Example random value: ${Math.random() * 100}`;\n                myDialog.data.content = myContent(myValue);\n                myDialog.render(true);\n            }\n        }\n    },\n},\n    {\n        id: 'test'\n    }\n).render(true);","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670267769350,"modifiedTime":1670267932576,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"AxhIKnwfRyItjnJG"}
{"name":"New Macro","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"let myValue = await Dialog.prompt({\n    content: `<input type=\"text\">`,\n    callback: (html) => html.find('input').val()\n});","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670267769350,"modifiedTime":1670267976665,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"AxhIKnwfRyItjnJG"}
{"name":"New Macro","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"// Allows the GM to change other user's hotbar from the GM client, in case of a player screwing up / prepping an adventure with ready made actors \n// and macros for the players.\n// v9 tested only, but probably works in v0.89 of FoundryVTT.\n\nfunction userSelect() {\n    const select = $(\"#macro-placement-dialog select[name=user-id]\");\n    const userId = select[0].value;\n    const user = game.users.get(userId);\n    const macroList = game.macros.filter(e => e.testUserPermission(user, CONST.DOCUMENT_PERMISSION_LEVELS.OBSERVER)).sort((a,b) => {\n        if(a.name.toLowerCase() > b.name.toLowerCase()) return 1;\n        if(a.name.toLowerCase() < b.name.toLowerCase()) return -1;\n        if(a.name.toLowerCase() === b.name.toLowerCase()) return 0;\n    }).reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`,``);\n    $(\"#macro-placement-dialog select[name=macro-id]\").empty();\n    $(\"#macro-placement-dialog select[name=macro-id]\").append(macroList);\n    const rows = [1,2,3,4,5].reduce((rows, tab, i)=> {\n        const row = [1,2,3,4,5,6,7,8,9,10].reduce((row, pos) => {\n            pos = pos + (i * 10);\n            const img = !game.macros.get(user.data.hotbar[pos]) ? \"\" : game.macros.get(user.data.hotbar[pos]).data.img;\n            const hoverText = !game.macros.get(user.data.hotbar[pos]) ? \"Empty\" : game.macros.get(user.data.hotbar[pos]).data.name;\n            return row += `<a class=\"macro-slot slot-${pos}\"><img src=\"${img}\"><span class=\"hover-text\">${hoverText}</span></a>`;\n        }, `<div class=\"tab-label\">Bar ${tab}:</div>`);\n        rows.push(row);\n        return rows;\n    },[]);\n    for(let i = 0; i < 5; i++) {\n        let element = $(`.row${i+1}`);\n        element.empty();\n        element.append(rows[i]);\n    }\n    $(\"#macro-placement-dialog a.macro-slot\").click(macroLeftClick);\n    $(\"#macro-placement-dialog a.macro-slot\").contextmenu(macroRightClick);\n}\n\nasync function macroLeftClick(event){\n    const macroId = $(\"#macro-placement-dialog select[name=macro-id]\")[0].value;\n    const userId = $(\"#macro-placement-dialog select[name=user-id]\")[0].value;\n    const slotNumber = Number(Array.from(event.currentTarget.classList)[1].split(\"-\")[1]);\n    const user = game.users.get(userId);\n    let hotbar = duplicate(user.data.hotbar);\n    hotbar[slotNumber] = macroId;\n    await user.update({hotbar},{diff: false, render: true, recursive: false, noHook: true});\n    userSelect();\n}\n\nasync function macroRightClick(event){\n    const userId = $(\"#macro-placement-dialog select[name=user-id]\")[0].value;\n    const slotNumber = Number(Array.from(event.currentTarget.classList)[1].split(\"-\")[1]);\n    const user = game.users.get(userId);\n    let hotbar = duplicate(user.data.hotbar);\n    delete hotbar[slotNumber];\n    await user.update({hotbar}, {diff: false, render: true, recursive: false, noHook: true});\n    userSelect();\n}\n\nasync function handleEvents(html) {\n    html.find(\"[name=user-id]\").change(userSelect);\n    userSelect();\n}\n\nconst sortedMacros = game.macros.contents.sort((a,b) => {\n    if(a.name.toLowerCase() > b.name.toLowerCase()) return 1;\n    if(a.name.toLowerCase() < b.name.toLowerCase()) return -1;\n    if(a.name.toLowerCase() === b.name.toLowerCase()) return 0;\n});\nconst optionsMacro = sortedMacros.reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`,``);\nconst optionsUser = game.users.reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`,``);\n\nconst style = `<style>\n    #macro-placement-dialog .window-content {\n        background: none;\n        color: white;\n    }\n    #macro-placement-dialog img {\n        border: none;\n    }\n    #macro-placement-dialog select {\n        background-color: #CCC;\n    }\n    #macro-placement-dialog .macro-box-row {\n        display: flex;\n        justify-content: space-between;\n        padding: 10px;\n    }\n    #macro-placement-dialog .macro-slot {\n        width: 75px;\n        height: 75px;\n        border: 2px solid #CCC;\n    }\n    #macro-placement-dialog .tab-label {\n        line-height: 75px; \n    }\n    #macro-placement-dialog a.macro-slot:hover{\n        border: 2px solid red;\n    }\n    #macro-placement-dialog .hover-text{\n        visibility: hidden;\n        width: max-content;\n        background-color: white;\n        color: #000;\n        text-align: center;\n        border-radius: 6px;\n        padding: 5px 5px;\n        position: absolute;\n        z-index: 1;\n    }\n    #macro-placement-dialog .macro-slot:hover .hover-text {\n        visibility: visible;\n    }\n</style>`;\nconst content = style + `<form>\n    <div class=\"form-group\">\n        <label>User:</label>\n        <div class=\"form-fields\">\n            <select name=\"user-id\">${optionsUser}</select>\n        </div>\n    </div>\n    <div class=\"form-group\">\n        <label>Macro:</label>\n        <div class=\"form-fields\">\n            <select name=\"macro-id\">${optionsMacro}</select>\n        </div>\n    </div>\n    <hr>\n    <div class=\"macro-box-row row1\"></div>\n    <div class=\"macro-box-row row2\"></div>\n    <div class=\"macro-box-row row3\"></div>\n    <div class=\"macro-box-row row4\"></div>\n    <div class=\"macro-box-row row5\"></div>\n</form>`;\n\nnew Dialog ({\n    title: \"Hotbar Management Tool\",\n    content,\n    buttons: {},\n    render: handleEvents\n},{\n    id: \"macro-placement-dialog\",\n    width: 900\n}).render(true);","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670267769350,"modifiedTime":1670268263509,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"AxhIKnwfRyItjnJG"}
{"$$deleted":true,"_id":"oK2i2eeLdW71adwZ"}
{"name":"New Macro","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"// Allows the GM to change other user's hotbar from the GM client, in case of a player screwing up / prepping an adventure with ready made actors \n// and macros for the players.\n// v9 tested only, but probably works in v0.89 of FoundryVTT.\n// Author: Freeze\n// Code thief: me\n\nfunction userSelect() {\n    const select = $(\"#macro-placement-dialog select[name=user-id]\");\n    const userId = select[0].value;\n    const user = game.users.get(userId);\n    const macroList = game.macros.filter(e => e.testUserPermission(user, CONST.DOCUMENT_PERMISSION_LEVELS.OBSERVER)).sort((a,b) => {\n        if(a.name.toLowerCase() > b.name.toLowerCase()) return 1;\n        if(a.name.toLowerCase() < b.name.toLowerCase()) return -1;\n        if(a.name.toLowerCase() === b.name.toLowerCase()) return 0;\n    }).reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`,``);\n    $(\"#macro-placement-dialog select[name=macro-id]\").empty();\n    $(\"#macro-placement-dialog select[name=macro-id]\").append(macroList);\n    const rows = [1,2,3,4,5].reduce((rows, tab, i)=> {\n        const row = [1,2,3,4,5,6,7,8,9,10].reduce((row, pos) => {\n            pos = pos + (i * 10);\n            const img = !game.macros.get(user.data.hotbar[pos]) ? \"\" : game.macros.get(user.data.hotbar[pos]).data.img;\n            const hoverText = !game.macros.get(user.data.hotbar[pos]) ? \"Empty\" : game.macros.get(user.data.hotbar[pos]).data.name;\n            return row += `<a class=\"macro-slot slot-${pos}\"><img src=\"${img}\"><span class=\"hover-text\">${hoverText}</span></a>`;\n        }, `<div class=\"tab-label\">Bar ${tab}:</div>`);\n        rows.push(row);\n        return rows;\n    },[]);\n    for(let i = 0; i < 5; i++) {\n        let element = $(`.row${i+1}`);\n        element.empty();\n        element.append(rows[i]);\n    }\n    $(\"#macro-placement-dialog a.macro-slot\").click(macroLeftClick);\n    $(\"#macro-placement-dialog a.macro-slot\").contextmenu(macroRightClick);\n}\n\nasync function macroLeftClick(event){\n    const macroId = $(\"#macro-placement-dialog select[name=macro-id]\")[0].value;\n    const userId = $(\"#macro-placement-dialog select[name=user-id]\")[0].value;\n    const slotNumber = Number(Array.from(event.currentTarget.classList)[1].split(\"-\")[1]);\n    const user = game.users.get(userId);\n    let hotbar = duplicate(user.data.hotbar);\n    hotbar[slotNumber] = macroId;\n    await user.update({hotbar},{diff: false, render: true, recursive: false, noHook: true});\n    userSelect();\n}\n\nasync function macroRightClick(event){\n    const userId = $(\"#macro-placement-dialog select[name=user-id]\")[0].value;\n    const slotNumber = Number(Array.from(event.currentTarget.classList)[1].split(\"-\")[1]);\n    const user = game.users.get(userId);\n    let hotbar = duplicate(user.data.hotbar);\n    delete hotbar[slotNumber];\n    await user.update({hotbar}, {diff: false, render: true, recursive: false, noHook: true});\n    userSelect();\n}\n\nasync function handleEvents(html) {\n    html.find(\"[name=user-id]\").change(userSelect);\n    userSelect();\n}\n\nconst sortedMacros = game.macros.contents.sort((a,b) => {\n    if(a.name.toLowerCase() > b.name.toLowerCase()) return 1;\n    if(a.name.toLowerCase() < b.name.toLowerCase()) return -1;\n    if(a.name.toLowerCase() === b.name.toLowerCase()) return 0;\n});\nconst optionsMacro = sortedMacros.reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`,``);\nconst optionsUser = game.users.reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`,``);\n\nconst style = `<style>\n    #macro-placement-dialog .window-content {\n        background: none;\n        color: white;\n    }\n    #macro-placement-dialog img {\n        border: none;\n    }\n    #macro-placement-dialog select {\n        background-color: #CCC;\n    }\n    #macro-placement-dialog .macro-box-row {\n        display: flex;\n        justify-content: space-between;\n        padding: 10px;\n    }\n    #macro-placement-dialog .macro-slot {\n        width: 75px;\n        height: 75px;\n        border: 2px solid #CCC;\n    }\n    #macro-placement-dialog .tab-label {\n        line-height: 75px; \n    }\n    #macro-placement-dialog a.macro-slot:hover{\n        border: 2px solid red;\n    }\n    #macro-placement-dialog .hover-text{\n        visibility: hidden;\n        width: max-content;\n        background-color: white;\n        color: #000;\n        text-align: center;\n        border-radius: 6px;\n        padding: 5px 5px;\n        position: absolute;\n        z-index: 1;\n    }\n    #macro-placement-dialog .macro-slot:hover .hover-text {\n        visibility: visible;\n    }\n</style>`;\nconst content = style + `<form>\n    <div class=\"form-group\">\n        <label>User:</label>\n        <div class=\"form-fields\">\n            <select name=\"user-id\">${optionsUser}</select>\n        </div>\n    </div>\n    <div class=\"form-group\">\n        <label>Macro:</label>\n        <div class=\"form-fields\">\n            <select name=\"macro-id\">${optionsMacro}</select>\n        </div>\n    </div>\n    <hr>\n    <div class=\"macro-box-row row1\"></div>\n    <div class=\"macro-box-row row2\"></div>\n    <div class=\"macro-box-row row3\"></div>\n    <div class=\"macro-box-row row4\"></div>\n    <div class=\"macro-box-row row5\"></div>\n</form>`;\n\nnew Dialog ({\n    title: \"Hotbar Management Tool\",\n    content,\n    buttons: {},\n    render: handleEvents\n},{\n    id: \"macro-placement-dialog\",\n    width: 900\n}).render(true);","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670267769350,"modifiedTime":1670270795191,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"AxhIKnwfRyItjnJG"}
{"name":"New Macro","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/symbols/star-solid-gold.webp","command":"// Allows the GM to change other user's hotbar from the GM client, in case of a player screwing up / prepping an adventure with ready made actors \n// and macros for the players.\n// v9 tested only, but probably works in v0.89 of FoundryVTT.\n// Author: Freeze\n// Code thief: me\n\nfunction userSelect() {\n    const select = $(\"#macro-placement-dialog select[name=user-id]\");\n    const userId = select[0].value;\n    const user = game.users.get(userId);\n    const macroList = game.macros.filter(e => e.testUserPermission(user, CONST.DOCUMENT_PERMISSION_LEVELS.OBSERVER)).sort((a,b) => {\n        if(a.name.toLowerCase() > b.name.toLowerCase()) return 1;\n        if(a.name.toLowerCase() < b.name.toLowerCase()) return -1;\n        if(a.name.toLowerCase() === b.name.toLowerCase()) return 0;\n    }).reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`,``);\n    $(\"#macro-placement-dialog select[name=macro-id]\").empty();\n    $(\"#macro-placement-dialog select[name=macro-id]\").append(macroList);\n    const rows = [1,2,3,4,5].reduce((rows, tab, i)=> {\n        const row = [1,2,3,4,5,6,7,8,9,10].reduce((row, pos) => {\n            pos = pos + (i * 10);\n            const img = !game.macros.get(user.data.hotbar[pos]) ? \"\" : game.macros.get(user.data.hotbar[pos]).data.img;\n            const hoverText = !game.macros.get(user.data.hotbar[pos]) ? \"Empty\" : game.macros.get(user.data.hotbar[pos]).data.name;\n            return row += `<a class=\"macro-slot slot-${pos}\"><img src=\"${img}\"><span class=\"hover-text\">${hoverText}</span></a>`;\n        }, `<div class=\"tab-label\">Bar ${tab}:</div>`);\n        rows.push(row);\n        return rows;\n    },[]);\n    for(let i = 0; i < 5; i++) {\n        let element = $(`.row${i+1}`);\n        element.empty();\n        element.append(rows[i]);\n    }\n    $(\"#macro-placement-dialog a.macro-slot\").click(macroLeftClick);\n    $(\"#macro-placement-dialog a.macro-slot\").contextmenu(macroRightClick);\n}\n\nasync function macroLeftClick(event){\n    const macroId = $(\"#macro-placement-dialog select[name=macro-id]\")[0].value;\n    const userId = $(\"#macro-placement-dialog select[name=user-id]\")[0].value;\n    const slotNumber = Number(Array.from(event.currentTarget.classList)[1].split(\"-\")[1]);\n    const user = game.users.get(userId);\n    let hotbar = duplicate(user.data.hotbar);\n    hotbar[slotNumber] = macroId;\n    await user.update({hotbar},{diff: false, render: true, recursive: false, noHook: true});\n    userSelect();\n}\n\nasync function macroRightClick(event){\n    const userId = $(\"#macro-placement-dialog select[name=user-id]\")[0].value;\n    const slotNumber = Number(Array.from(event.currentTarget.classList)[1].split(\"-\")[1]);\n    const user = game.users.get(userId);\n    let hotbar = duplicate(user.data.hotbar);\n    delete hotbar[slotNumber];\n    await user.update({hotbar}, {diff: false, render: true, recursive: false, noHook: true});\n    userSelect();\n}\n\nasync function handleEvents(html) {\n    html.find(\"[name=user-id]\").change(userSelect);\n    userSelect();\n}\n\nconst sortedMacros = game.macros.contents.sort((a,b) => {\n    if(a.name.toLowerCase() > b.name.toLowerCase()) return 1;\n    if(a.name.toLowerCase() < b.name.toLowerCase()) return -1;\n    if(a.name.toLowerCase() === b.name.toLowerCase()) return 0;\n});\nconst optionsMacro = sortedMacros.reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`,``);\nconst optionsUser = game.users.reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`,``);\n\nconst style = `<style>\n    #macro-placement-dialog .window-content {\n        background: none;\n        color: white;\n    }\n    #macro-placement-dialog img {\n        border: none;\n    }\n    #macro-placement-dialog select {\n        background-color: #CCC;\n    }\n    #macro-placement-dialog .macro-box-row {\n        display: flex;\n        justify-content: space-between;\n        padding: 10px;\n    }\n    #macro-placement-dialog .macro-slot {\n        width: 75px;\n        height: 75px;\n        border: 2px solid #CCC;\n    }\n    #macro-placement-dialog .tab-label {\n        line-height: 75px; \n    }\n    #macro-placement-dialog a.macro-slot:hover{\n        border: 2px solid red;\n    }\n    #macro-placement-dialog .hover-text{\n        visibility: hidden;\n        width: max-content;\n        background-color: white;\n        color: #000;\n        text-align: center;\n        border-radius: 6px;\n        padding: 5px 5px;\n        position: absolute;\n        z-index: 1;\n    }\n    #macro-placement-dialog .macro-slot:hover .hover-text {\n        visibility: visible;\n    }\n</style>`;\nconst content = style + `<form>\n    <div class=\"form-group\">\n        <label>User:</label>\n        <div class=\"form-fields\">\n            <select name=\"user-id\">${optionsUser}</select>\n        </div>\n    </div>\n    <div class=\"form-group\">\n        <label>Macro:</label>\n        <div class=\"form-fields\">\n            <select name=\"macro-id\">${optionsMacro}</select>\n        </div>\n    </div>\n    <hr>\n    <div class=\"macro-box-row row1\"></div>\n    <div class=\"macro-box-row row2\"></div>\n    <div class=\"macro-box-row row3\"></div>\n    <div class=\"macro-box-row row4\"></div>\n    <div class=\"macro-box-row row5\"></div>\n</form>`;\n\nnew Dialog ({\n    title: \"Hotbar Management Tool\",\n    content,\n    buttons: {},\n    render: handleEvents\n},{\n    id: \"macro-placement-dialog\",\n    width: 900\n}).render(true);","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670267769350,"modifiedTime":1670270891777,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"AxhIKnwfRyItjnJG"}
{"$$deleted":true,"_id":"S6p8Pvs1rUktIN1L"}
{"$$deleted":true,"_id":"kvUZskEx5GoNkv0d"}

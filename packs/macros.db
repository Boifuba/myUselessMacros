{"name":"Throwing Calculator","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/skills/ranged/bomb-grenade-thrown-purple.webp","scope":"global","command":"// // if (canvas.tokens.controlled.length === 0)\n// //   return ui.notifications.error(\"Select the falling token\");\n\n if (canvas.tokens.controlled.length === 0)\n  return ui.notifications.error(\"Select a token\");\n\n\n\nconst myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/throwing.html\");\n\nnew Dialog({\n  title: \"GURPS\",\n  content: myContent,\n  buttons: {}\n}, { id: 'GURPScss'}).render(true);","flags":{"core":{"sourceId":"Macro.IbF4f8qjepR6bZ9t"},"cf":{"id":"temp_etvk8gr4cam"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547621,"modifiedTime":1669696547621,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"0TAheGWP5AROQwLb"}
{"name":"Hiking Calculator","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/skills/movement/feet-winged-sandals-tan.webp","scope":"global","command":"// if (canvas.tokens.controlled.length === 0)\n//   return ui.notifications.error(\"Select the falling token\");\n\nif (canvas.tokens.controlled.length === 0)\n  return ui.notifications.error(\"Select the token leader\");\n\n\n\nconst myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/hiking.html\");\n\nnew Dialog({\n  title: \"GURPS Hiking Calculator\",\n  content: myContent,\n  buttons: {}\n}).render(true);","flags":{"core":{"sourceId":"Macro.TbasT3DKsY3L0nec"},"cf":{"id":"temp_etvk8gr4cam"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547622,"modifiedTime":1669696547622,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"6QQwbjw5DI8Nhy7u"}
{"name":"Macros Folder","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/containers/boxes/crate-heavy-yellow.webp","scope":"global","command":"const managerType = \"Macros Folder\";\n\n(() => {\n  const macros = [\n    \"Random Treasure Generator\",\n    \"Instant Defaults\",\n    \"Tables Folder\",\n    \"Hiking Calculator\",\n    \"Falling Calculator\",\n    \"Throwing Calculator\",\n    \"Sight Togle\",\n    \"Fatigue\",\n    \"Sight Toggle\",\n    \"Sight Adjustment\",\n    \"Body Parts\",\n    \"Healing Tool\"\n\n  ];\n\n  let buttons = {},\n    dialog,\n    content = `<div sytle=\"display:flex;text-align:center;><h2>Choose Macro</h2></div>`;\n\n\n  macros.forEach((str) => {\n    let macro = game.macros.getName(str);\n    if (!macro) return;\n\n    buttons[str] = {\n      label: `\n       \n<style>\n#GURPScs .window-content {\n    background-image: url('systems/gurps/icons/hex2.webp');\n        background-color: #353434;\n        display: inline-block;\n          width: 100%;\n\n\n  }\n\n  \n\n  #GURPScs header {\n    font-family: Roboto;\n    background-color: #353434;\n    border-radius: 0;\n    border: none;\n    margin-bottom: 2px;\n    font-size: .75rem;\n  }\n\n#GURPScs .dialog-button {\n  border: 1px solid #18181a;\n  color: #18181a;\n  font-size: 15px;\n  line-height: 15px;\n  padding: 5px 5px 5px;\n  width: 100%;\n  height: 100%;\n  cursor: cell;\n  background: #807f7f;\n  border-radius: 18px;\n  margin-bottom: 2px;\n      }\n\n    #GURPScs .dialog-button:hover {\n  background-color: #353434; /* Green */\n  color: white;\n    box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19);\n    }\n\n      </style> \n         <div style=\"display:flex;flex-direction:row;justify-content:center;align-items:center;\">\n          \n        <div style=\"display:flex;justify-content:left;flex-grow:1;\">\n        <img src=\"${macro.img}\" width=\"50\" height=\"50\" style=\"background-color:#5c5c5c;;border-radius: 10px;margin: 3px 3px 3px;\"/></div>\n          <source src=\"/sounds/pop.mp3\" type=\"audio/mpeg\">\n\n        <div style=\"display:flex;justify-content:left;flex-grow:1\"><label>${str}</label></div>\n        </div>\n        \n        \n        \n        \n        \n        \n        \n        \n        \n        \n        \n        `,\n      callback: () => {\n        game.macros.getName(str).execute();\n        dialog.render(true);\n      },\n    };\n  });\n  dialog = new Dialog(\n    { title: `${managerType}`, content, buttons },\n    { id: \"GURPScs\" }\n  ).render(true);\n})();","flags":{"core":{"sourceId":"Macro.ul71YhG3o9fguYNU"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547625,"modifiedTime":1669696547625,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"6pvKH4kMzvWgbmcB"}
{"name":"Browse to Popout","type":"script","scope":"global","author":"1wvFEddoeqrS4gB1","img":"icons/skills/targeting/crosshair-mark-rough-pink.webp","command":"await new FilePicker({type: \"image\", path: \"images/portraits/\", callback: picked}).render(true);\n\nasync function picked(image) {\n const ip = new ImagePopout(image, {title: \"GURPS Japan\",});\n ip.render(true);\n ip.shareImage();\n}","ownership":{"default":0,"1wvFEddoeqrS4gB1":3},"flags":{"core":{"sourceId":"Macro.pkPaHMVpvs9uGLAe"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.17","coreVersion":"10.291","createdTime":1671905871204,"modifiedTime":1671909116582,"lastModifiedBy":"1wvFEddoeqrS4gB1"},"folder":null,"sort":0,"_id":"79E5JbG2sqQkVxWA"}
{"name":"ReactionRoll","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/environment/people/group.webp","scope":"global","command":"let r = new Roll(\"3d6 + @mod\", { mod: GURPS.ModifierBucket.currentSum()})\ngame.tables.getName(\"Reaction Rolls\").draw({roll:r})\nGURPS.ModifierBucket.clear()","flags":{"furnace":{"runAsGM":false},"core":{"sourceId":"Macro.BAVCAmeEE34jS0dN"},"importid":"SwxFagE3eJmQSiTu","cf":{"id":"temp_58ibxbr8cng"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547622,"modifiedTime":1669696547622,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"8oH7TPH1GJFhi8jN"}
{"name":"Tables Folder","type":"script","author":"mW8b5k19Zu6i2R2v","img":"modules/gurps-instant-defaults/img/icons/critical.png","scope":"global","command":"const managerType = \"Tables Folder\";\n\n(() => {\n  const tables = [\n    \"Critical Head Blow\",\n    \"Critical Hit\",\n    \"Critical Magic\",\n    \"Critical Miss\",\n    \"Critical Unarmed Strike\",\n    \"Reaction Rolls\",\n    \"Sight Toggle\",\n    \"Sight Adjustment\",\n    \"Healing Tool\",\n    \"Body Parts\"\n\n  ];\n\n  let buttons = {},\n    dialog,\n    content = `<div sytle=\"display:flex;text-align:center;><h2>Choose Macro</h2></div>`;\n\n\n  tables.forEach((str) => {\n    let table = game.tables.getName(str);\n    if (!table) return;\n\n    buttons[str] = {\n      label: `\n       \n<style>\n#tf .window-content {\n    background-image: url('systems/gurps/icons/hex2.webp');\n        background-color: #353434;\n        display: inline-block;\n          width: 100%;\n\n\n  }\n\n  \n\n  #bp header {\n    font-family: Roboto;\n    background-color: #353434;\n    border-radius: 0;\n    border: none;\n    margin-bottom: 2px;\n    font-size: .75rem;\n  }\n\n#tf .dialog-button {\n  border: 1px solid #18181a;\n  color: #18181a;\n  font-size: 15px;\n  line-height: 15px;\n  padding: 5px 5px 5px;\n  width: 100%;\n  height: 100%;\n  cursor: cell;\n  background: #807f7f;\n  border-radius: 18px;\n  margin-bottom: 2px;\n      }\n\n    #tf .dialog-button:hover {\n  background-color: #353434; /* Green */\n  color: white;\n    box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19);\n    }\n\n      </style> \n         <div style=\"display:flex;flex-direction:row;justify-content:center;align-items:center;\">\n          \n        <div style=\"display:flex;justify-content:left;flex-grow:1;\">\n        <img src=\"${table.img}\" width=\"50\" height=\"50\" style=\"background-color:#5c5c5c;;border-radius: 10px;margin: 3px 3px 3px;\"/></div>\n          <source src=\"/sounds/pop.mp3\" type=\"audio/mpeg\">\n\n        <div style=\"display:flex;justify-content:left;flex-grow:1\"><label>${str}</label></div>\n        </div>\n        \n        \n        \n        \n        \n        \n        \n        \n        \n        \n        \n        `,\n      callback: () => {\n        game.tables.getName(str).draw();\n        dialog.render(true);\n      },\n    };\n  });\n  dialog = new Dialog(\n    { title: `${managerType}`, content, buttons },\n    { id: \"tf\" }\n  ).render(true);\n})();","flags":{"core":{"sourceId":"Macro.PiqMWUzecRiYnlTN"},"cf":{"id":"temp_58ibxbr8cng"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547625,"modifiedTime":1669696547625,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"AgKR8PJVGy3nBNMH"}
{"name":"Random Treasure Generator","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/commodities/currency/coins-crown-stack-gold.webp","scope":"global","command":"const myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/generator.html\");\n\nnew Dialog({\n  title: \"GURPS\",\n  content: myContent,\n  buttons: {}\n}).render(true);","flags":{"core":{"sourceId":"Macro.wSj4vPsv6Xmxhldm"},"cf":{"id":"temp_etvk8gr4cam"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547625,"modifiedTime":1669696547625,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"EGvJiSUpUUQD7Asg"}
{"name":"Grenades Distance","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/weapons/thrown/bomb-fuse-red-black.webp","scope":"global","command":"tokenD = canvas.tokens.controlled[0]\nif(!token) return;\nconst targets = Array.from(game.user.targets);\nconst gridSize = canvas.grid.size;\nconst startPoint = {x:tokenD.x,y: tokenD.y};\nlet messageData = \"<h2>Grenade Distance</h2><br>\";\n\nfunction d6(min, max) { \n    return Math.floor(Math.random() * (max - min + 1) + min)\n  }\n\n targets.forEach(async target => {\n    const distance = canvas.grid.measureDistance(startPoint, target, {gridSpaces: true}).toFixed(1); \n    let c = 0 \n    while (c <= 20 ){\n    if (distance == c)messageData += `<b>${target.name}</b> Is <b>${c} yards </b>from grenade <br>`;\n        c++\n}\n    \n});\nChatMessage.create({content: messageData});","flags":{"core":{"sourceId":"Macro.IP19df5Giwp6zFmf"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547621,"modifiedTime":1669696547621,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"FqLB3LKzDMz9HeTt"}
{"name":"Teleport","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/sonic/explosion-shock-wave-teal.webp","command":"let myMacro = game.macros.getName(\"Teleport\");\nmyMacro.update({img: \"icons/magic/sonic/explosion-shock-wave-teal.webp\"});\n\n\n\n\nasync function captureClick(fn, remove = true){\n  const m = () => canvas.app.renderer.plugins.interaction.mouse.getLocalPosition(canvas.app.stage);\n  const c = (p) => canvas.grid.getCenter(p.x,p.y);\n\n  return await new Promise(async (resolve) => {\n    $(document.body).on(\"click\", async (e) => {\n      if(remove) $(document.body).off(\"click\");\n      resolve(fn(e,m(),c(m())));\n    });\n  });\n}\n\nlet tokens = [];\nif(event.shiftKey) {\n    console.log(canvas.tokens.placeables);\n    tokens = canvas.tokens.placeables.filter(t => t.actor.type === \"character\" && t.actor.hasPlayerOwner);\n}\nelse {\n    tokens = canvas.tokens.controlled;\n}\nawait new Promise(resolve => {setTimeout(resolve, 100)});\nui.notifications.warn(`Click to relocate!`);\nawait captureClick(async (event, position, grid) => {\n    let update = tokens.map((t,i) => ({_id: t.id, x: grid[0] - canvas.grid.size / 2 + i * (canvas.grid.size / 2), y: grid[1] - canvas.grid.size / 2 + i * (canvas.grid.size / 2)}));\n    console.log(`Click Captured | `, {event, position, grid});\n    return await canvas.scene.updateEmbeddedDocuments(\"Token\", update, {animate:false});\n});\n\nui.notifications.info(\"Done!\");","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.e8Cpe3Zdh0mVzUoa"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.17","coreVersion":"10.291","createdTime":1671264215042,"modifiedTime":1672540978754,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":null,"sort":0,"_id":"IW0Ta1nzTFlHOTEJ"}
{"name":"Apply Manual Damage","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/skills/wounds/injury-pain-body-orange.webp","scope":"global","command":"function manualDamage(damage, type) {\n  GURPS.executeOTF(`/r [${damage} ${type}]`);\n}\nnew Dialog({\n  title: `Manual Damage`,\n  content: \n`<form>\n<style>\nform#form-group {\n  background-color: red;\n}\n</style>\n <form>\n      <div class=\"form-group\">\n        <label>Damage Type: </label>\n        <select id=\"damageType\" name=\"damageType\">\n          <option value=\"burn\">Burning</option>\n          <option value=\"cor\">Corrosion</option>\n          <option value=\"cr\">Crushing</option>\n          <option value=\"imp\">Impaling</option>\n          <option value=\"pi-\">Smal piercing</option>\n          <option value=\"pi\">Piercing</option>\n          <option value=\"pi+\">Large Piercing</option>\n          <option value=\"pi+\">Large Piercing</option>\n          <option value=\"pi++\">Huge Piercing</option>\n          <option value=\"tox\">Toxic</option>\n          <option value=\"sh\">Shield</option>\n             \n          \n          \n          </select>\n      </div>\n     \n  </form>  \n  \n  <form>\n<div class=\"form-group\">\n  <label>Damage Amount:</label>\n  <input id=\"damageAmount\" name=\"damageAmount\"  value=\"\" min=\"1\" max=\"20\">\n  </div>   \n  `,\n  buttons: {\n    confirm: {\n      label: \"Confirm\",\n      callback: async (html) => {\n        manualDamage(html.find('#damageAmount').val(), html.find('#damageType').val());\n      }\n    }\n  }\n}, {\n  width: 400\n}).render(true);","flags":{"core":{"sourceId":"Macro.Bjf1SqGzABywtOTp"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547623,"modifiedTime":1669696547623,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"Mipo4PgkYWdvN0gW"}
{"name":"Change lights to torch","type":"chat","scope":"global","author":"1wvFEddoeqrS4gB1","img":"icons/sundries/lights/torch-brown-lit.webp","command":"await canvas.lighting.updateAll({\"config.animation.type\": \"torch\",  \"config.animation.intensity\": 2, \"config.animation.speed\": 5});","ownership":{"default":0,"1wvFEddoeqrS4gB1":3},"flags":{"core":{"sourceId":"Macro.3kU7d0XCQ6RbUzVs"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.17","coreVersion":"10.291","createdTime":1671911156404,"modifiedTime":1671911346645,"lastModifiedBy":"1wvFEddoeqrS4gB1"},"folder":null,"sort":0,"_id":"MlzaLJIeQKo7jaZW"}
{"name":"Hover","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/air/wind-weather-snow-gusts.webp","command":"//Require TokenMagicFx Module and Jb2a.\n//Don't cry.\n\nlet error = false;\n\nif (!(game.modules.get(\"sequencer\")?.active)) {\n    error = `You need to have Sequencer installed and activated to run this macro!`;\n}\nif (!(game.modules.get(\"TokenMagicFx\")?.active)) {\n    error = `You need to have Sequencer installed and activated to run this macro!`;\n}\n\n\nif (error) {\n    ui.notifications.error(error);\n    return;\n}\n\n\n\nconst effects = Sequencer.EffectManager.getEffects({ name: \"*Levita*\" });\nconst tokenD = canvas.tokens.controlled[0];\n\n\nif(effects.length){\n  Sequencer.EffectManager.endEffects({ name: \"*Levita*\" });\n  token.document.update({elevation: token.data.elevation =0});\n  \n   TokenMagic.deleteFiltersOnSelected();\n//TokenMagic.addUpdateFiltersOnSelected();\n  }else{\n\ntoken.document.update({elevation: token.data.elevation +10});\n\n\n\n\nnew Sequence()\n    .effect()\n        .file(\"modules/jb2a_patreon/Library/TMFX/OutFlow/Circle/OutFlow_02_Circle_500x500.webm\") \n        .scale(2)\n        .atLocation(tokenD)\n        .attachTo(tokenD, { bindVisibility: false} )\n        .belowTokens()\n        .opacity(0.5)\n        .persist()\n        .name(\"Levita\")\n\n       \n\n            \n    .play()\n    \n    let params =\n    [{\n        filterType: \"shadow\",\n        filterId: \"myShadow\",\n        rotation: 195,\n        blur: 3,\n        quality: 5,\n        distance: 20,\n        alpha: 0.6,\n        padding: 20,\n        shadowOnly: false,\n        color: 0x000000,\n        zOrder: 8000,\n        animated:\n        {\n            blur:     \n            { \n               active: true, \n               loopDuration: 500, \n               animType: \"syncCosOscillation\", \n               val1: 2, \n               val2: 4\n            },\n            rotation:\n            {\n               active: true,\n               loopDuration: 100,\n               animType: \"syncSinOscillation\",\n               val1: 33,\n               val2: 37\n            }\n         }\n    }];\n    \n    let params2 =\n        [{\n            filterType: \"transform\",\n            filterId: \"dodgeStance\",\n            padding: 50,\n            animated:\n            {\n                translationX:\n                {\n                    animType: \"sinOscillation\",\n                    val1: -0.060,\n                    val2: +0.060,\n                    loopDuration: 9600,\n                },\n                translationY:\n                {\n                    animType: \"cosOscillation\",\n                    val1: -0.035,\n                    val2: +0.035,\n                    loopDuration: 9400,\n                }\n            }\n        }];\nawait TokenMagic.addUpdateFiltersOnSelected(params);\nawait TokenMagic.addUpdateFiltersOnSelected(params2);\n \n  }","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.FjALz9PbTwVGdu2O"},"cf":{"id":"temp_cngbk5ad9e4"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670263972783,"modifiedTime":1670272972659,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":null,"sort":0,"_id":"OKo3T3t4ty3SFu5m"}
{"name":"Copiador de Ficha","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"giver = \"Hōjō Misaki\"\nrecipient = \"Kazuya Yoshida\"\ngame.actors.getName(recipient).update({\"system\": game.actors.getName(giver).system})","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.TKfVk5OZErWaergW"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.17","coreVersion":"10.291","createdTime":1672076007505,"modifiedTime":1672076030037,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":null,"sort":0,"_id":"P5ipJMBtDGYgiAL9"}
{"name":"Colored Borders","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/symbols/ring-circle-smoke-blue.webp","command":"const myContent = `<style>\n    .callheader {\n      background-color: black;\n      font-family: Roboto, sans-serif;\n      color: white;\n      text-align: center;\n      vertical-align: middle;\n      line-height: 50px;\n      height: 50px;\n      margin-bottom: 10px;\n      border-radius: 0.375rem;\n      font-size: 18px;\n      text-decoration: none;\n    }\n  </style>\n  <div class=\"callheader\">Colored Borders</div>\n\n  <form>\n    <div class=\"form-group\">\n      <label>Size</label>\n      <div class=\"form-fields\">\n        <input id=\"sizes\" type=\"number\" name=\"sizes\">\n      </div>\n    </div>\n  </form>\n  <div class=\"coluna3\">\n    <form>\n      <div class=\"form-group\">\n        <label style=\"text-align: left\">Color </label>\n        <div class=\"form-fields\">\n          <select id=\"cores\" name=\"cores\">\n            <option value=\"yellow\">Yellow</option>\n            <option value=\"Pink\">Purple</option>\n            <option value=\"blue\">Blue</option>\n            <option value=\"bluewhite\">Blue White</option>\n            <option value=\"Pink\">Pink</option>\n            <option value=\"Red\">Red</option>\n            <option value=\"Orange\">Orange</option>\n            <option value=\"Red\">Red</option>\n            <option value=\"White\">White</option>\n            <option value=\"Green\">Green</option>     \n            <option value=\"sides\">Sides</option>       \n              <option value=\"cyberpunk\">Cyberpunk</option>       \n\n          </select>\n        </div>\n      </div>\n    </form>\n  </div>\n  <br>\n  <button class=\"banana-set-size\" role=\"button\">Banana</button>\n`;\n\n\nlet error = false;\n\nif (!(game.modules.get(\"sequencer\")?.active)) {\n    error = `You need to have Sequencer installed and activated to run this macro!`;\n}\nif (error) {\n    ui.notifications.error(error);\n    return;\n}\n\nconst macro = this;\nnew Dialog({\n    title: \"GURPS Instant Colored Borders\",\n    content: myContent,\n    buttons: {},\n    render: async (html) => listeners(html)\n}).render(true);\n\nasync function listeners(html) {\n    if (macro.getFlag(\"world\", \"sizes\")) html.find(\"#sizes\").val(macro.getFlag(\"world\", \"sizes\"));\n    else html.find(\"#sizes\").val(0);\n    html.click(async function (event) {\n        if (event.target.className === \"banana-set-size\") {\n            const size = html.find(\"#sizes\").val(); \n            const cor = html.find(\"#cores\").val(); \n            await macro.setFlag(\"world\", \"sizes\", size);\n            await aplica(size, cor);\n            html.find(\"#sizes\").val(size)\n        }\n    });\n}\nasync function aplica(size, cor) {\n    let token = canvas.tokens.controlled[0]\n    const effects = Sequencer.EffectManager.getEffects({\n        name: \"*bordinha*\",\n        object: token,\n    });\n    if (effects.length) {\n        console.log(\"removing effect\")\n        Sequencer.EffectManager.endEffects({ name: \"*bordinha*\", object: token });\n    }\n    else {\n        console.log(\"adding effect\", size, cor)\n        new Sequence()\n            .effect()\n            .file(`/modules/gurps-instant-defaults/packs/borders/${cor}.webm`)\n            .attachTo(token)\n            .scale(Number(size))\n            .atLocation(token)\n            .persist()\n            .name(\"bordinha\")\n            .elevation(0)\n            .play();\n    }\n}","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"world":{"sizes":"0.39","poder":{"foo":"$350","bar":"$540","zip":"$400"}},"gurps-instant-defaults":{"sizes":""},"core":{"sourceId":"Macro.S5hjkNBOiqdm8lmb"},"combat-utility-belt":{"macroTrigger":""}},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1665459890841,"modifiedTime":1669696547625,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"PQ2Y3q1o8l3H4ZUP"}
{"name":"Healing Tool","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/holy/chalice-glowing-gold-water.webp","scope":"global","command":"const targets = Array.from(game.user.targets);\n\n//MINOR HEALING\n\n\nfunction minorHealing(energy) {\n  if ((energy > 3)) {\n    ui.notifications.error(\"The value need to be equal or lower than 3\");\n    dialogEditor.render(true);\n        \n \n//  energy = Object.keys(energy).length === 0 {\n//       ui.notifications.error(\"Choose a value between 1-3\");\n      \n      \n\n    } else {\n      \n      \n      GURPS.executeOTF(`/r [/hp +${energy}  @target]`)\n      GURPS.executeOTF(`/r [/fp -${energy}]`)\n    }\n  }\n\n\n  //MAJOR HEALING\n\n\nfunction majorHealing(energy) {\n  if ((canvas.tokens.controlled[0] === 0 & Array.from(game.user.targets)[0] === 0)) {\n    ui.notifications.error(\"You need some energy to cast this spell!\");\n    dialogEditor.render(true);\n\n  } else {\n    let realHealing = energy * 2\n    targets.forEach((target) => {\n    GURPS.executeOTF(`/r [/hp +${realHealing}  @target]`)\n    GURPS.executeOTF(`/r [/fp -${energy}]`);\n    }\n    )};\n  \n\n}\n\n//GREATER HEALING\n\nfunction greaterHealing(energy) {\n\n  GURPS.executeOTF(`/r [/hp reset  @target]`)\n  GURPS.executeOTF(`/r [/fp -20]`)\n}\n\nlet dialogContent =\n` \n\n    <form>\n    <div class=\"form-group\">\n      <label>Fatigue Points:</label>\n      <input id=\"energy\" name=\"energy\" type=\"number\" value=\"1\" min=\"1\" max=\"20\">\n      </div>    \n`\n  ;\n\n//let applyChanges = false\nlet dialogButtons = {\n \n\n  minorHealing: {\n\n    label: `Minor Healing`,\n    callback: async (html) => minorHealing(html.find('#energy').val())\n  },\n  majorHealing: {\n\n    label: `Major Healing`,\n    callback: async (html) => majorHealing(html.find('#energy').val())\n  },\n  greaterHealing: {\n\n    label: `Greater Healing`,\n    callback: async (html) => greaterHealing(html.find('#energy').val())\n  }\n}\n\nlet dialogEditor = new Dialog({\n  title: `Instant Healings`,\n  content: dialogContent,\n  buttons: dialogButtons,\n  default: \"yes\",\n})\n\ndialogEditor.render(true);","flags":{"core":{"sourceId":"Macro.npfhk5aF2sMZi0Cg"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547622,"modifiedTime":1669696547622,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"Q6XVPWj1b7dcqMFa"}
{"name":"Summon Tile","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"async function captureClick(fn, remove = true){\n  const m = () => canvas.app.renderer.plugins.interaction.mouse.getLocalPosition(canvas.app.stage);\n  const c = (p) => canvas.grid.getCenter(p.x,p.y);\n\n  return await new Promise(async (resolve) => {\n    $(document.body).on(\"click\", async (e) => {\n      if(remove) $(document.body).off(\"click\");\n      resolve(fn(e,m(),c(m())));\n    });\n  });\n}\n\nawait new Promise(resolve => {setTimeout(resolve, 100)});\nui.notifications.warn(`Click para posicionar a imagem no mapa`);\nawait captureClick(async (event, position, grid) => {\n    let newTile = [{\n      img: \"worlds/japao/img/hannafuda.webp\",\n      //scale: 0.5,\n      x: grid[0]-125,\n      y: grid[1]-200,\n      z: 10,\n      width: 251,\n      height: 400,    \n      rotation: 5,\n      hidden: false,\n      locked: false,\n    }];\n    await canvas.scene.createEmbeddedDocuments(\"Tile\", newTile);\n\n   \nlet target = canvas.tokens.controlled[0]\nlet tile = canvas.tiles.controlled[0] \n\n\n    new Sequence()\n    .effect()\n        .file(\"jb2a.bless.200px.intro.yellow\")\n        .atLocation(target)\n        .waitUntilFinished(-500) \n    .effect()\n        .file(\"jb2a.bless.200px.loop.yellow\")\n        .atLocation(target)        \n        .waitUntilFinished()        \n    .effect()\n        .file(\"jb2a.bless.200px.loop.yellow\")\n        .atLocation(target) \n        .fadeOut(1000)\n    .play()\n    \nGURPS.executeOTF('/sound worlds/japao/sound/japanese-bruh-sound-effect-2.mp3')\nconst text = `<p style=\"background-color: black; color: white; text-align: center; font-size: 20px; height: 55px;padding-top: 15px; \"> ${GURPS.LastActor.name} </p> <p style=\"background-color: orange; color: white; margin-top: -10px;padding: 5px;  \">Você pode tentar alterar o Destino e tem 3 tentativas</p>`\nChatMessage.create({ \n    content: `${text}`, \n    speaker: { alias: \"Maneki Neko\" } \n});\n\n});\nui.notifications.info(`${GURPS.LastActor.name} invocou o Unmei!`)","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.t0jeMjRmuFIVVaF2"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.17","coreVersion":"10.291","createdTime":1672076077803,"modifiedTime":1672540997825,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":null,"sort":0,"_id":"QGoXPvw9fhAOPZaC"}
{"name":"Compendium to rollrable","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"const key = \"world.High Tech Equipment\" \n\nconst compendium = game.packs.get(key); \nlet i = 0;\nconst compendiumContents = compendium.index.map(e => {\n    i++;\n    const img = e?.img ?? \"icons/svg/dice-target.svg\";\n    return {\n        text: e.name,\n        type: CONST.TABLE_RESULT_TYPES.COMPENDIUM,\n        collection: key,\n        resultId: e.id,\n        img,\n        weight: 1,\n        range: [i, i],\n        drawn: false\n    }\n});\nRollTable.create({\n    name: compendium.metadata.label,\n    description: `All entries from the ${compendium.metadata.label} compendium`,\n    results: compendiumContents,\n    formula: `1d${compendiumContents.length}`\n});","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.o9y7eBjdvyFCr3Ji"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.17","coreVersion":"10.291","createdTime":1671690010456,"modifiedTime":1671690062876,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":null,"sort":0,"_id":"S0rKmOoqKDYDtWd7"}
{"name":"#[CF_tempEntity]","type":"chat","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","scope":"global","command":"","flags":{"cf":{"id":"temp_pn0x3le0bx","name":"Macros","color":"#000000","fontColor":"#FFFFFF","icon":"","sorting":"m","contents":["Mipo4PgkYWdvN0gW","fDRqOMS9bjXzklNo","wyNigTPiNMYjTunO","Y2fZDdbuWuIzXswL","FqLB3LKzDMz9HeTt","Q6XVPWj1b7dcqMFa","UgkpRFYETNuhxfHP","6pvKH4kMzvWgbmcB","aV4XLgmciSv50a1m","iFyJBTGtcraM5HgT"],"children":[],"folderPath":[],"version":"2.5.5"},"core":{"sourceId":"Compendium.myUselessMacros.GURPS4E-Macro.3Xlz0rgOgRi2lJX7"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1669696547621,"modifiedTime":1670271593512,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"SnpQkxZAKRawdYLr"}
{"name":"Journal Menu","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/tools/scribal/ink-quill-pink.webp","scope":"global","command":"const managerType = 'Journal Menu';\n\n(()=>{\n  const journals = [\n    \n    \"Vision\",\n    \"Escudo\"   \n\n  ];\n\n    let buttons = {}, dialog, content = `<div sytle=\"width:100%;text-align:center;><h2>Choose Journal</h2></div>`;\n  \n  \n  journals.forEach((str)=> {\n    let journal = game.journal.getName(str);\n    if(!journal) return;\n\n    buttons[str] = {\n      label : `\n        <div style=\"display:flex;flex-direction:row;justify-content:center;align-items:center;\">\n          \n        <div style=\"display:flex;justify-content:left;flex-grow:1;\">\n        \n          <source src=\"/sounds/pop.mp3\" type=\"audio/mpeg\">\n\n        <div style=\"display:flex;justify-content:left;flex-grow:1\"><label>${str}</label></div>\n        </div>`,\n      callback : () => {\n        game.journal.getName(str).sheet.render(true);\n       dialog.render(true);\n      }\n    }\n  });\n  dialog = new Dialog({title : `${managerType}`,content, buttons}).render(true);\n})();","flags":{"core":{"sourceId":"Macro.2mBXApLhSAET8wtI"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547623,"modifiedTime":1669696547623,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"UgkpRFYETNuhxfHP"}
{"name":"Grease","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/unholy/barrier-fire-pink.webp","command":"// require sequencer and tokenMagicFX\n\n\n\nconst tokenD = canvas.tokens.controlled[0];\n//change the template color invisible\nconst templateObject = canvas.templates.placeables[canvas.templates.placeables.length - 1]\nawait templateObject.document.update({ fillColor: \"\" })\n\n\nnew Sequence()\n    .effect()\n    .file(\"jb2a.fire_bolt.green02\")\n    .atLocation(tokenD)\n    .stretchTo({ x: templateObject.data.x, y: templateObject.data.y })\n    .waitUntilFinished(-500)\n\n    .effect()\n    .file(\"modules/jb2a_patreon/Library/1st_Level/Grease/Grease_Dark_Green_600x600.webm\")\n    .scaleToObject(1.3)\n    .attachTo(templateObject)\n    .persist()\n    .scaleIn(0.1, 200, { ease: \"easeOutQuint\", delay: 100 })\n    .fadeOut(1000, { ease: \"easeInQuad\" })\n    .belowTokens()\n    .name(\"Grease\")\n\n    .play()","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.HzId7gWBoze0B48l"},"cf":{"id":"temp_cngbk5ad9e4"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670271287279,"modifiedTime":1670272983882,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":null,"sort":0,"_id":"Wa4WkvigEnbtzRhE"}
{"name":"Weapons with  Fast-draw","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/weapons/swords/sword-broad-serrated-blue.webp","command":"let myMacro = game.macros.getName(\"Weapons with  Fast-draw\");\nmyMacro.update({img: \"icons/weapons/swords/sword-broad-serrated-blue.webp\"});\n\n\n\n\nconst myContent = `<style>\n    .callheader {\n      background-color: black;\n      font-family: Roboto, sans-serif;\n      color: white;\n      text-align: center;\n      vertical-align: middle;\n      line-height: 50px;\n      height: 50px;\n      margin-bottom: 10px;\n      border-radius: 0.375rem;\n      font-size: 18px;\n      text-decoration: none;\n    }\n  </style>\n  <div class=\"callheader\">Draw Weapon</div>\n<form class=\"flexcol\">\n            <div class=\"form-group\">\n\n                <label for=\"weapons\">Draw</label>\n                <div class=\"form-fields\">\n\n                    <select id=\"melee\">\n                           <option>Choose a weapon</option>\n                    </select>\n                </div>\n            </div>\n      </form>\n\n\n<form class=\"flexcol\">\n            <div class=\"form-group\">\n\n                <label for=\"fastDraw\">Fast Draw</label>\n                <div class=\"form-fields\">\n\n                    <select id=\"fastDraw\">\n                           <option>Choose Fast Draw</option>\n                    </select>\n                </div>\n            </div>\n      </form>\n       <br>\n  <button class=\"banana-set-size\" role=\"button\">Set Weapon</button>\n  <button class=\"fast-draw\" role=\"button\">Roll Fast Draw</button>\n\n`;\n\n\n\n\n\nconst macro = this;\nnew Dialog({\n    title: \"GURPS Draw Weapon\",\n    content: myContent,\n    buttons: {},\n    render: async (html) => listeners(html)\n}).render(true);\n\nasync function listeners(html) {\nlet select = document.getElementById(\"melee\");\nlet select2 = document.getElementById(\"fastDraw\");\n\nconst melee = Object.values(GURPS.LastActor.system.melee).map(e => e.name);\nconst ranged = Object.values(GURPS.LastActor.system.ranged).map(e => e.name);\n//const fastDraw = Object.values(GURPS.LastActor.system.skills).map(e =>  { if (e.name.includes(\"Fast-Draw\")) return e.name })\n\n const fastDraw = Object.values(GURPS.LastActor.system.skills).filter(e =>  e.name.includes(\"Fast-Draw\")).map(e => e.name)\n\n\n\n\nfunction removeDuplicates(melee) {\n    return melee.filter((item, index) => melee.indexOf(item) === index);\n}\nfunction removeDuplicates(ranged) {\n    return ranged.filter((item, index) => ranged.indexOf(item) === index);\n}\n\nconst lista = melee.concat(ranged);\nlet limpo = removeDuplicates(lista)\n// const index = lista.indexOf(\"Natural Attacks\");\n// if (index > -1) {\n//     lista.splice(index, 1);\n// }\n\n//melee and ranged weapons\nfor(var i = 0; i < limpo.length; i++) {\n    var opt = limpo[i];\n    var el = document.createElement(\"option\");\n    el.textContent = opt;\n    el.value = opt;\n    select.appendChild(el);\n}\n\nfor(var i = 0; i < fastDraw.length; i++) {\n    var opt = fastDraw[i];\n    var el = document.createElement(\"option\");\n    el.textContent = opt;\n    el.value = opt;\n    select2.appendChild(el);\n}\n html.click(async function (event) {\n        if (event.target.className === \"banana-set-size\") {\n            const mostra = html.find(\"#melee\").val(); \n            game.actors.getName(GURPS.LastActor.name).setFlag(\"world\", \"armas\", mostra)\n        let consulta = game.actors.getName(GURPS.LastActor.name).getFlag(\"world\", \"armas\", lista)\n           ChatMessage.create({ \n    content: `I'm using ${mostra} now!`, \n    speaker: { alias: `${GURPS.LastActor.name}` } \n});\n}\n        \n        if (event.target.className === \"fast-draw\") {\n            const rollDraw = html.find(\"#fastDraw\").val(); \n            GURPS.executeOTF(`/r [Sk:${rollDraw}]`)\n        }\n    });\n}","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.t1urlbBJvON3xmKZ"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.17","coreVersion":"10.291","createdTime":1672541119830,"modifiedTime":1672541196018,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":null,"sort":0,"_id":"Wi1Tic2s0d57vUsI"}
{"name":"Fatigue","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/equipment/feet/boots-leather-laced-brown.webp","scope":"global","command":"/*\nOnly works in GURPS Game Aid.(how are you feeling now DnD'ers?)\nSelect your party e click to run the macro. The FP adjustmentes will be made based\non your actual encumbrance. When use it to calculate FP on Hiking, stop the hiking\nand recalculate when the first character is 1/3 FP.\nI hope you enjoy it!\n*/\nif (canvas.tokens.controlled.length === 0)\n  return ui.notifications.error(\"Select the tokens\");\n\n\n\nlet actors = canvas.tokens.controlled.map((i) => i.actor);\nif (!actors.length)\n  actors = game.users\n    .filter((i) => i.active && !!i.character)\n    .map((i) => i.character);\nfor (const actor of actors) {\n  const encumbrance = actor.system.encumbrance;\n  const FP = actor.system.FP;\n  const current = Object.values(encumbrance).find((i) => i.current);\n  const key = current.key;\n  const value = actor.system.FP.value;\n  if (key === \"enc0\") await actor.update({ \"data.FP.value\": value - 1 });\n  else if (key === \"enc1\") await actor.update({ \"data.FP.value\": value - 2 });\n  else if (key === \"enc2\") await actor.update({ \"data.FP.value\": value - 3 });\n  else if (key === \"enc3\") await actor.update({ \"data.FP.value\": value - 4 });\n  else if (key === \"enc4\") await actor.update({ \"data.FP.value\": value - 5 });\n  ChatMessage.create({content:  `<p>${actor.name} have <b>${FP.value} FP</b></p>`});\n}","flags":{"core":{"sourceId":"Macro.E2P570JwpoQEoRPl"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547624,"modifiedTime":1669696547624,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"Y2fZDdbuWuIzXswL"}
{"name":"Macro Organizer","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/symbols/star-solid-gold.webp","command":"function userSelect() {\n    const select = $(\"#macro-placement-dialog select[name=user-id]\");\n    const userId = select[0].value;\n    const user = game.users.get(userId);\n    const macroList = game.macros.filter(e => e.testUserPermission(user, CONST.DOCUMENT_PERMISSION_LEVELS.OBSERVER)).sort((a,b) => {\n        if(a.name.toLowerCase() > b.name.toLowerCase()) return 1;\n        if(a.name.toLowerCase() < b.name.toLowerCase()) return -1;\n        if(a.name.toLowerCase() === b.name.toLowerCase()) return 0;\n    }).reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`,``);\n    $(\"#macro-placement-dialog select[name=macro-id]\").empty();\n    $(\"#macro-placement-dialog select[name=macro-id]\").append(macroList);\n    const rows = [1,2,3,4,5].reduce((rows, tab, i)=> {\n        const row = [1,2,3,4,5,6,7,8,9,10].reduce((row, pos) => {\n            pos = pos + (i * 10);\n            const img = !game.macros.get(user.data.hotbar[pos]) ? \"\" : game.macros.get(user.data.hotbar[pos]).data.img;\n            const hoverText = !game.macros.get(user.data.hotbar[pos]) ? \"Empty\" : game.macros.get(user.data.hotbar[pos]).data.name;\n            return row += `<a class=\"macro-slot slot-${pos}\"><img src=\"${img}\"><span class=\"hover-text\">${hoverText}</span></a>`;\n        }, `<div class=\"tab-label\">Bar ${tab}:</div>`);\n        rows.push(row);\n        return rows;\n    },[]);\n    for(let i = 0; i < 5; i++) {\n        let element = $(`.row${i+1}`);\n        element.empty();\n        element.append(rows[i]);\n    }\n    $(\"#macro-placement-dialog a.macro-slot\").click(macroLeftClick);\n    $(\"#macro-placement-dialog a.macro-slot\").contextmenu(macroRightClick);\n}\n\nasync function macroLeftClick(event){\n    const macroId = $(\"#macro-placement-dialog select[name=macro-id]\")[0].value;\n    const userId = $(\"#macro-placement-dialog select[name=user-id]\")[0].value;\n    const slotNumber = Number(Array.from(event.currentTarget.classList)[1].split(\"-\")[1]);\n    const user = game.users.get(userId);\n    let hotbar = duplicate(user.data.hotbar);\n    hotbar[slotNumber] = macroId;\n    await user.update({hotbar},{diff: false, render: true, recursive: false, noHook: true});\n    userSelect();\n}\n\nasync function macroRightClick(event){\n    const userId = $(\"#macro-placement-dialog select[name=user-id]\")[0].value;\n    const slotNumber = Number(Array.from(event.currentTarget.classList)[1].split(\"-\")[1]);\n    const user = game.users.get(userId);\n    let hotbar = duplicate(user.data.hotbar);\n    delete hotbar[slotNumber];\n    await user.update({hotbar}, {diff: false, render: true, recursive: false, noHook: true});\n    userSelect();\n}\n\nasync function handleEvents(html) {\n    html.find(\"[name=user-id]\").change(userSelect);\n    userSelect();\n}\n\nconst sortedMacros = game.macros.contents.sort((a,b) => {\n    if(a.name.toLowerCase() > b.name.toLowerCase()) return 1;\n    if(a.name.toLowerCase() < b.name.toLowerCase()) return -1;\n    if(a.name.toLowerCase() === b.name.toLowerCase()) return 0;\n});\nconst optionsMacro = sortedMacros.reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`,``);\nconst optionsUser = game.users.reduce((acc, e) => acc += `<option value=\"${e.id}\">${e.name}</option>`,``);\n\nconst style = `<style>\n    #macro-placement-dialog .window-content {\n        background: none;\n        color: white;\n    }\n    #macro-placement-dialog img {\n        border: none;\n    }\n    #macro-placement-dialog select {\n        background-color: #CCC;\n    }\n    #macro-placement-dialog .macro-box-row {\n        display: flex;\n        justify-content: space-between;\n        padding: 10px;\n    }\n    #macro-placement-dialog .macro-slot {\n        width: 75px;\n        height: 75px;\n        border: 2px solid #CCC;\n    }\n    #macro-placement-dialog .tab-label {\n        line-height: 75px; \n    }\n    #macro-placement-dialog a.macro-slot:hover{\n        border: 2px solid red;\n    }\n    #macro-placement-dialog .hover-text{\n        visibility: hidden;\n        width: max-content;\n        background-color: white;\n        color: #000;\n        text-align: center;\n        border-radius: 6px;\n        padding: 5px 5px;\n        position: absolute;\n        z-index: 1;\n    }\n    #macro-placement-dialog .macro-slot:hover .hover-text {\n        visibility: visible;\n    }\n</style>`;\nconst content = style + `<form>\n    <div class=\"form-group\">\n        <label>User:</label>\n        <div class=\"form-fields\">\n            <select name=\"user-id\">${optionsUser}</select>\n        </div>\n    </div>\n    <div class=\"form-group\">\n        <label>Macro:</label>\n        <div class=\"form-fields\">\n            <select name=\"macro-id\">${optionsMacro}</select>\n        </div>\n    </div>\n    <hr>\n    <div class=\"macro-box-row row1\"></div>\n    <div class=\"macro-box-row row2\"></div>\n    <div class=\"macro-box-row row3\"></div>\n    <div class=\"macro-box-row row4\"></div>\n    <div class=\"macro-box-row row5\"></div>\n</form>`;\n\nnew Dialog ({\n    title: \"Hotbar Management Tool\",\n    content,\n    buttons: {},\n    render: handleEvents\n},{\n    id: \"macro-placement-dialog\",\n    width: 900\n}).render(true);","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.AxhIKnwfRyItjnJG"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.17","coreVersion":"10.291","createdTime":1670267769350,"modifiedTime":1672541280117,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":null,"sort":0,"_id":"YO9uqCGR3XKScFFc"}
{"name":"Random picker","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/skills/targeting/crosshair-pointed-orange.webp","command":"//select a bunch of tokens and execute macro.\n\n\nconst tokens = canvas.tokens.controlled;\nconst rand = Math.floor(Math.random() * tokens.length);\nconst name = tokens[rand].document.name;\nconst image = tokens[rand].document.texture.src;\nChatMessage.create({\n content: \"<div style='font-size: 1.8em; margin: 1em 0; text-align: center;'><img src='\" + image + \"' style='max-width:6em;border:none;'><br>\" + name + \"</div>\",\n whisper: [game.user.id]\n});","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.A5N2tK8oKLorO4iM"},"combat-utility-belt":{"macroTrigger":""}},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1666902698419,"modifiedTime":1670264383991,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"YxSbQmp4OCLOkuxH"}
{"name":"Sight Adjustment","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/skills/targeting/crosshair-arrowhead-blue.webp","scope":"global","command":"/*\nSelect all tokens to change the size of sight.\nClick on Macro with:\n\nCtrl  = Increase Sight +1\nAlt = decrease Sight -1\n\nOnly Click in the macro you will change your sight by 0\n\n*/\n\n\nconst updates = canvas.tokens.controlled.map(i => {\n  const dimSight = Number(i.document.sight.range);\n  const change = event.ctrlKey ? dimSight + 0.8 : event.altKey ? dimSight -1 : 0;\n  return {_id: i.id, dimSight: Math.max(change, 0)};\n});\nawait canvas.scene.updateEmbeddedDocuments(\"Token\", updates);","flags":{"core":{"sourceId":"Macro.x4SKjhUyWSJeecrz"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1664843591301,"modifiedTime":1669696547622,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"aV4XLgmciSv50a1m"}
{"name":"Falling Calculator","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/skills/movement/arrow-down-pink.webp","scope":"global","command":"if (canvas.tokens.controlled.length === 0)\n  return ui.notifications.error(\"Select the falling token\");\n\n\n\nconst myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/falling.html\");\n\nnew Dialog({\n  title: \"GURPS Instant Falling Damage\",\n  content: myContent,\n  buttons: {}\n}).render(true);","flags":{"core":{"sourceId":"Macro.edXnzxry3c8iIM2p"},"cf":{"id":"temp_etvk8gr4cam"},"combat-utility-belt":{"macroTrigger":""}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547621,"modifiedTime":1669696547621,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"ausDr2K1wDsAvlLP"}
{"name":"XP Giver","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/environment/wilderness/tree-oak.webp","command":"const myContent = `<style>\n    .callheader {\n      background-color: black;\n      font-family: Roboto, sans-serif;\n      color: white;\n      text-align: center;\n      vertical-align: middle;\n      line-height: 50px;\n      height: 50px;\n      margin-bottom: 10px;\n      border-radius: 0.375rem;\n      font-size: 18px;\n      text-decoration: none;\n    }\n  </style>\n  <div class=\"callheader\">XP Giver</div>\n\n  <form>\n    <div class=\"form-group\">\n      <label>How many points? </label>\n      <div class=\"form-fields\">\n        <input id=\"sizes\" type=\"number\" name=\"sizes\">\n      </div>\n    </div>\n  </form>\n \n  <br>\n  <button class=\"banana-set-size\" role=\"button\">Give XP</button> \n   <button class=\"register\" role=\"button\">Register xp\n</button>\n\n`;\n\nnew Dialog({\n  title: \"GURPS\",\n  content: myContent,\n  buttons: {},\n  render: async (html) => listeners(html)\n}).render(true);\nasync function listeners(html) {\n\n\n  html.click(async function (event) {\n    if (event.target.className === \"banana-set-size\") {\n\n\n      let actors = canvas.tokens.controlled.map((i) => i.actor);\n      for (const actor of actors) {\n        const pontos = html.find(\"#sizes\").val();\n        const pontosAtuais = actor.system.totalpoints.unspent;\n        const resultado = Math.floor(Number(pontosAtuais) + Number(pontos))\n        await actor.update({ \"system.totalpoints.unspent\": resultado });\n        await ChatMessage.create({\n          content: `<p>${actor.name} have <b>${resultado}XP now</b></p>`,\n        });\n      }\n    }\n      if (event.target.className === \"register\") {\n\nconst date = new Date().toDateString();\nconst pageName = `Session ${date}`;\nconst journal = game.journal.getName(\"xp\");\n\nlet entry = journal.pages.find(e => e.name === pageName);\nif(!entry) {\n    let pageContent = \" \"\n    let pageActual = ' '\n    let title = `     <th style=\"text-align: left; padding-left: 10px; \">Name</th>    <th style=\"text-align: left; \">Points</th> <th style=\"text-align: left; \">Unspent</th>`\n    let titulo = `<b>[ ${date} ]</b></br>`;\n   \nlet actors = canvas.tokens.controlled.map((i) => i.actor);\nfor (const actor of actors) {\n  const unspent = actor.system.totalpoints.unspent\n  const points = actor.system.totalpoints.total\n\n          \n          pageContent += `<tr><td> ${actor.name}</td><td>${points}</td><td>${unspent}</td></tr>`;\n        \n          \n          \n\n\n    }\n    \n\n  await JournalEntryPage.create({name: pageName, text: {content: '<table>' + '<thead>' + '<tr>' + title + '</tr>'  + pageContent  +   '</tbody>' + \n '</table>' , format: 1}, title: {show: false, level: 1}, \"ownership.default\": 3, sort: journal.sheet._pages.at(-1).sort + CONST.SORT_INTEGER_DENSITY}, {parent: journal});\n    journal.sheet.render(true);\n    //saveDataToFile(fileContent, \"text/plain\", fileName);\n}\nelse return ui.notifications.warn(`Journal Page - ${pageName} already exists`);\n    }\n  });\n}","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.Rc2VnwMmcJ85IVzE"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.17","coreVersion":"10.291","createdTime":1672541433198,"modifiedTime":1672541544947,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":null,"sort":0,"_id":"b638HfFMxEt3Fr12"}
{"name":"Resize","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/movement/chevrons-down-yellow.webp","command":"let tokens = canvas.tokens.controlled\ntokens.forEach(t => {\n    if (token.data.width<1)\n        t.document.update({\"width\": 1, \"height\": 1});\n    else if (token.data.width>=1)\n        t.document.update({\"width\": .5, \"height\": .5});\n})","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.78ZavNQFxJKwjqLU"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1665527251394,"modifiedTime":1669696547621,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"bsM8cFewrYOxNaj2"}
{"name":"#[CF_tempEntity]","type":"chat","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","scope":"global","command":"","flags":{"cf":{"id":"temp_etvk8gr4cam","name":"Calculator","color":"#000000","fontColor":"#FFFFFF","icon":"","sorting":"m","contents":["xd9cFMkOzEQTdXE1","fWZpIpraFbgH8RWa","ausDr2K1wDsAvlLP","mLxvvKASA0LpAK5a","6QQwbjw5DI8Nhy7u","EGvJiSUpUUQD7Asg","0TAheGWP5AROQwLb"],"children":[],"folderPath":[],"version":"2.5.5"},"core":{"sourceId":"Compendium.myUselessMacros.GURPS4E-Macro.ZTZZ2SJ2HKynNflz"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1669696547622,"modifiedTime":1670271593512,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"ddDYdO2aDMvHFOv5"}
{"name":"Unmei","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","command":"if(!token) return;\nconst ator = token.document.name\nconst image = 'worlds/japao/img/unmei.webp'\nconst pop = new ImagePopout(image, { title: `${ator} invoca o Unmei`, caption: ator });\npop.render(true); // Display for self\npop.shareImage(); // Display to all other players\nGURPS.executeOTF('/sound worlds/japao/sound/japanese-bruh-sound-effect-2.mp3')\nconst text = `<p style=\"background-color: black; color: white; text-align: center; font-size: 20px; height: 55px;padding-top: 15px; \"> ${ator} </p> <p style=\"background-color: orange; color: white; margin-top: -10px;padding: 5px;  \">Você pode tentar alterar o Destino e tem 3 tentativas</p>`\nChatMessage.create({ \n    content: `${text}`, \n    speaker: { alias: \"Maneki Neko\" } \n});\nlet tokenD = canvas.tokens.controlled[0]\n\nnew Sequence()\n    .effect()\n        .file(\"jb2a.bless.200px.intro.yellow\")\n        .atLocation(tokenD)\n        .waitUntilFinished(-500) \n    .effect()\n        .file(\"jb2a.bless.200px.loop.yellow\")\n        .atLocation(tokenD)        \n        .waitUntilFinished()        \n    .effect()\n        .file(\"jb2a.bless.200px.loop.yellow\")\n        .atLocation(tokenD) \n        .fadeOut(1000)\n    .play()","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.27UKXuybayjkIiGQ"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.17","coreVersion":"10.291","createdTime":1672076049563,"modifiedTime":1672076065348,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":null,"sort":0,"_id":"evw2SFIgaFjbhvDl"}
{"name":"Body Parts","type":"script","author":"mW8b5k19Zu6i2R2v","img":"modules/gurps-instant-defaults/img/icons/bodyParts/face.png","scope":"global","command":"const managerType = \"Body Parts\";\n\n(() => {\n  const tables = [\n    \"Abdomen\",\n    \"Arm\",\n    \"Chest\",\n    \"Face\",\n    \"Foot\",\n    \"Hand\",\n    \"Leg\",\n    \"Neck\"\n     ];\n\n  let buttons = {},\n    dialog,\n    content = `<div sytle=\"display:flex;text-align:center;><h2>Choose Macro</h2></div>`;\n\n\n  tables.forEach((str) => {\n    let table = game.tables.getName(str);\n    if (!table) return;\n\n    buttons[str] = {\n      label: `\n       \n<style>\n#bp .window-content {\n    background-image: url('systems/gurps/icons/hex2.webp');\n        background-color: #353434;\n        display: inline-block;\n          width: 100%;\n\n\n  }\n\n  \n\n  #bp header {\n    font-family: Roboto;\n    background-color: #353434;\n    border-radius: 0;\n    border: none;\n    margin-bottom: 2px;\n    font-size: .75rem;\n  }\n\n#bp .dialog-button {\n  border: 1px solid #18181a;\n  color: #18181a;\n  font-size: 15px;\n  line-height: 15px;\n  padding: 5px 5px 5px;\n  width: 100%;\n  height: 100%;\n  cursor: cell;\n  background: #807f7f;\n  border-radius: 18px;\n  margin-bottom: 2px;\n      }\n\n    #bp .dialog-button:hover {\n  background-color: #353434; /* Green */\n  color: white;\n    box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19);\n    }\n\n      </style> \n         <div style=\"display:flex;flex-direction:row;justify-content:center;align-items:center;\">\n          \n        <div style=\"display:flex;justify-content:left;flex-grow:1;\">\n        <img src=\"${table.img}\" width=\"50\" height=\"50\" style=\"background-color:#5c5c5c;;border-radius: 10px;margin: 3px 3px 3px;\"/></div>\n          <source src=\"/sounds/pop.mp3\" type=\"audio/mpeg\">\n\n        <div style=\"display:flex;justify-content:left;flex-grow:1\"><label>${str}</label></div>\n        </div>\n        \n        \n        \n        \n        \n        \n        \n        \n        \n        \n        \n        `,\n      callback: () => {\n        game.tables.getName(str).draw();\n        dialog.render(true);\n      },\n    };\n  });\n  dialog = new Dialog(\n    { title: `${managerType}`, content, buttons },\n    { id: \"bp\" }\n  ).render(true);\n})();","flags":{"core":{"sourceId":"Macro.bLIEcmBOaxoJl7yO"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547623,"modifiedTime":1669696547623,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"fDRqOMS9bjXzklNo"}
{"name":"Caesar's Cipher","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/sundries/gaming/dice-runed-brown.webp","scope":"global","command":"const myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/cripto.html\");\n\nnew Dialog({\n  title: \"GURPS\",\n  content: myContent,\n  buttons: {}\n}, { id: 'cypher'}).render(true);","flags":{"core":{"sourceId":"Macro.OUICocE2cU8t69eO"},"cf":{"id":"temp_etvk8gr4cam"},"combat-utility-belt":{"macroTrigger":""}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547623,"modifiedTime":1669696547623,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"fWZpIpraFbgH8RWa"}
{"name":"Tell the Odds","type":"script","scope":"global","author":"1wvFEddoeqrS4gB1","img":"icons/sundries/gaming/dice-pair-white-green.webp","command":"const myContent = `<style>\n    .callheader {\n      background-color: black;\n      font-family: Roboto, sans-serif;\n      color: white;\n      text-align: center;\n      vertical-align: middle;\n      line-height: 50px;\n      height: 50px;\n      margin-bottom: 10px;\n      border-radius: 0.375rem;\n      font-size: 18px;\n      text-decoration: none;\n    }\n\n    datalist {\n  display: flex;\n  justify-content: space-between;\n  width: 380px;\n}\n\noption {\n  padding: 0;\n}\n\ninput[type=\"range\"] {\n  width: 380px;\n  margin: 0px;\n}\n  </style>\n  <div class=\"callheader\">Tell me the odds</div>\n\n <div>\n <label for=\"pi_input\">Easy</label>\n <label for=\"pi_input\" style=\"margin-left:320px;\">Hard</label>\n  <input type=\"range\" id=\"pi_input\" name=\"pi_input list=\"values\" min=\"0\" max=\"100\">\n</div>\n<datalist id=\"values\">\n  <option value=\"0\" label=\"|\"></option>\n  <option value=\"25\" label=\"|\"></option>\n  <option value=\"50\" label=\"|\"></option>\n  <option value=\"75\" label=\"|\"></option>\n  <option value=\"100\" label=\"|\"></option>\n</datalist>\n\n<p>Chance: <output id=\"value\"></output>%</p>\n\n\n  <button class=\"banana-set-size\" role=\"button\">Banana</button>\n`;\n\nnew Dialog({\n  title: \"GURPS\",\n  content: myContent,\n  buttons: {},\n  render: async (html) => listeners(html)\n}).render(true);\n\nasync function listeners(html) {\n\n  const value = document.querySelector(\"#value\")\n  const input = document.querySelector(\"#pi_input\")\n  value.textContent = input.value\n  input.addEventListener(\"input\", (event) => {\n    value.textContent = event.target.value\n  })\n  html.click(async function (event) {\n    if (event.target.className === \"banana-set-size\") {\n      var values = $(\"#value\").val();\n\n\n       let randomNumber =  Math.floor(Math.random() * 101);\n\n\n      console.log(\"values:\", values)\n      console.log(\"RandomNumbers:\", randomNumber)\n\n\n      if (values > randomNumber) {\n        ChatMessage.create({\n          content: \"You finded what you were looking for.\",\n          speaker: { alias: \"Tell the Odds\" }\n        });\n      } else {\n        ChatMessage.create({\n          content: \"You didn't find what you were looking for.\",\n          speaker: { alias: \"Tell the Odds\" }\n        });\n      }\n    }\n  });\n}","ownership":{"default":0,"1wvFEddoeqrS4gB1":3},"flags":{"core":{"sourceId":"Macro.OXb7OqcQ93ovM2HR"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.18","coreVersion":"10.291","createdTime":1672981424281,"modifiedTime":1672987844010,"lastModifiedBy":"1wvFEddoeqrS4gB1"},"folder":null,"sort":0,"_id":"ffvDYZ07drw0g2g0"}
{"name":"Chidori","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/lightning/orb-ball-spiral-blue.webp","command":"/* To use this macro you'll need these modules:\nsequencer\nwarpgate\njb2a patreon version.\n\nJust install the modules and paste this macro as script.\ni hope you enjoy\n*/ \n\n\n\nlet tokenD = canvas.tokens.controlled[0];\nif (!tokenD) { return; }\nconst effects = Sequencer.EffectManager.getEffects({ name: \"bolaDeEnergia\", object: tokenD });\n\nif (effects.length) {\n    Sequencer.EffectManager.endEffects({ name: \"*bolaDeEnergia*\", object: tokenD });\n\n    let targets = Array.from(game.user.targets);\n    targets.forEach((target) => {\n        new Sequence()\n            .effect()\n            .file(\"modules/jb2a_patreon/Library/Generic/Lightning/LightningBall_01_Regular_Blue_400x400.webm\")\n            .atLocation(token, { randomOffset: true })\n            .moveTowards(target)\n            .scale(0.25)\n            .moveSpeed(1500)\n            .wait(500)\n\n            .effect()\n            .file(\"modules/jb2a_patreon/Library/Generic/Lightning/LightningBall_01_Regular_Blue_400x400.webm\")\n            .belowTokens()\n            .atLocation(target)\n            .scaleOut(0.1, 500, { ease: \"easeInOutBounce\", delay: 0 })\n\n            .play()\n    })\n\n    // const updates = Array.from(game.user.targets).map(t => ({_id: t.id, \"light.bright\": 1, \"animation\": {type: \"torch\", speed: 3, intensity: 1}}));\n    //      canvas.scene.updateEmbeddedDocuments(\"Token\", updates);\n   \n   \n    setTimeout((function() {\n        const updates = Array.from(game.user.targets).map(t => ({_id: t.id, 'light.color': '#75b8ff',\n        'light.alpha': 0.8,\"light.bright\": 1, \"animation\": {type: \"torch\", speed: \"9\", intensity: \"8\"}}));\n         canvas.scene.updateEmbeddedDocuments(\"Token\", updates);\n    }), 200)\n    \n    setTimeout((function() {\n        const updates = Array.from(game.user.targets).map(t => ({_id: t.id, \"light.bright\": 0, \"animation\": {type: \"torch\", speed: 0, intensity: 0}}));\n         canvas.scene.updateEmbeddedDocuments(\"Token\", updates);\n    }), 3000)\n\n\n\n\n} else {\n    //efeito bolaDeEnergia\n\n    new Sequence()\n        .effect()\n        .file(\"modules/jb2a_patreon/Library/Generic/Lightning/LightningBall_01_Regular_Blue_400x400.webm\")\n        .scale(0.25)\n        .atLocation(tokenD, { randomOffset: true })\n        .zeroSpriteRotation(true)\n        .attachTo(tokenD, { bindVisibility: false })\n        .name(\"bolaDeEnergia\")\n        .persist()\n        .spriteOffset({ x: 10, y: 0 })\n        .zeroSpriteRotation(true)\n        .play()\n\n}\n\n\nconst cDimLight = 2;\nconst cBrightLight = 1;\nconst cAnimationType = \"torch\";\nconst cAngle = 360;\n\n\nlet dataUpdate = {\n    'light.angle': !token.data.angle ? cAngle : 0,\n    'light.dim': !token.data.light.dim ? cDimLight : 0,\n    'light.bright': !token.data.light.bright ? cBrightLight : 0,\n    'light.color': '#75b8ff',\n    'light.alpha': 0.5,\n    'light.animation': { \"type\": cAnimationType, \"speed\": 9, \"intensity\": 8 }\n};\ntokenD.document.update(dataUpdate);","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.fruXCvPXIKzztVRK"},"cf":{"id":"temp_cngbk5ad9e4"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670273178422,"modifiedTime":1670273344197,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":null,"sort":0,"_id":"gP7U7iCoJI3i43Kf"}
{"name":"Sight Toggle","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/perception/shadow-stealth-eyes-purple.webp","scope":"global","command":"if (canvas.tokens.controlled.length === 0)\n  return ui.notifications.error(\"Select your token token\");\n\nawait token.document.update({sightAngle : token.document.sight.angle === 360 ? 275 : 360});","flags":{"core":{"sourceId":"Macro.kRKbNVaRiRhyjZOD"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1664843588971,"modifiedTime":1669696547625,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"iFyJBTGtcraM5HgT"}
{"name":"Browse to Popout","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/commodities/treasure/bust-carved-stone.webp","command":"let myMacro = game.macros.getName(\"Browse to Popout\");\nmyMacro.update({img: \"icons/commodities/treasure/bust-carved-stone.webp\"});\n\nawait new FilePicker({type: \"image\", path: \"images/portraits/\", callback: picked}).render(true);\n\nasync function picked(image) {\n const ip = new ImagePopout(image, {title: \"GURPS Japan\",});\n ip.render(true);\n ip.shareImage();\n}","ownership":{"default":0,"1wvFEddoeqrS4gB1":3,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.pkPaHMVpvs9uGLAe"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.17","coreVersion":"10.291","createdTime":1671905871204,"modifiedTime":1672540747217,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":null,"sort":0,"_id":"ihVhC4iPqrzht3C6"}
{"name":"First Aid Calculator","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/magic/life/heart-glowing-red.webp","scope":"global","command":"const myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/firstAid.html\");\n\nnew Dialog({\n  title: \"GURPS\",\n  content: myContent,\n  buttons: {}\n}).render(true);","flags":{"core":{"sourceId":"Macro.eiBOlcjpYF6WwZ5M"},"cf":{"id":"temp_etvk8gr4cam"},"combat-utility-belt":{"macroTrigger":""}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547621,"modifiedTime":1669696547621,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"mLxvvKASA0LpAK5a"}
{"name":"#[CF_tempEntity]","type":"chat","author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","scope":"global","command":"","flags":{"cf":{"id":"temp_58ibxbr8cng","name":"Tables","color":"#000000","fontColor":"#FFFFFF","icon":"","sorting":"m","contents":["8oH7TPH1GJFhi8jN","AgKR8PJVGy3nBNMH"],"children":[],"folderPath":[],"version":"2.5.5"},"core":{"sourceId":"Compendium.myUselessMacros.GURPS4E-Macro.QnA9iTItTiNFCEi9"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1669696547622,"modifiedTime":1670271593512,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"pUk8bV1LcojyXZ3R"}
{"name":"Draw Walls","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/environment/settlement/city-wall.webp","command":"let drawings = canvas.drawings.controlled;\n\nif (!drawings.length) return ui.notifications.warn(\"No Drawings\");\ndrawings = drawings.map(drawing => {\n    console.log(drawing.document);\n    switch (drawing.document.shape.type) {\n        case \"f\":\n        case \"p\": {\n            let { id, rotation, x, y  } = drawing.document;\n            let { width, height , points} = drawing.document.shape;\n            points = points.reduce((a,x,i)=> {\n              if((i+2)%2) a[Math.floor(i/2)].push(x);\n              else a.push([x]);\n              return a;\n            }, []);\n            return { id, valid: true, points, rotation, x, y, width, height };\n        }\n        case \"r\": {\n            let { id, rotation, x, y  } = drawing.document;\n            let { width, height } = drawing.document.shape;\n            const points = [\n                [0, 0],\n                [width, 0],\n                [width, height],\n                [0, height],\n                [0, 0],\n            ];\n            return { id, valid: true, points, rotation, x, y, width, height };\n        }\n        case \"e\": {\n            let { id, rotation, x, y  } = drawing.document;\n            let { width, height} = drawing.document.shape;\n            let size = (height>width?height:width)/canvas.grid.size*60;\n            let segmentCount = Math.max(Math.ceil(Math.sqrt(size/2)), 4);\n            let step = 2*Math.PI/segmentCount;  // see note 1\n            let h = drawing.center.x-x;\n            let k = drawing.center.y-y;\n            let r = width/2;\n            let t = height/width;\n            let points = [];\n            let segment = [];\n            let start = [];\n            for(let theta=0;  theta < 2*Math.PI;  theta+=step) { \n              let x = h +     r*Math.cos(theta);\n              let y = k - t * r*Math.sin(theta); \n              \n               if (theta==0) \n                start = [Math.round(x), Math.round(y)];\n              \n              points.push([Math.round(x),Math.round(y)]);\n              \n              if (segment.length > 2)\n               points.push(segment.map(p=>p))\n            }\n            points.push(start)\n            return { id, valid: true, points, rotation, x, y, width, height };\n          }\n        default:\n            return { id: drawing.data._id, valid: false }; \n    }\n}).filter(drawing => {\n    if (!drawing.valid) {\n        ui.notifications.warn(`Drawing \"${drawing.id}\" is not a valid drawing type`);\n        return false;\n    }\n    return true;\n});\n\n//console.log(\"drawings\", drawings)\n    const newWalls = drawings.flatMap((drawing) => {\n        const { x, y, width, height } = drawing;\n        const xCenterOffset = width/2;\n        const yCenterOffset = height/2;\n        \n        const θ = Math.toRadians(drawing.rotation);\n        const cosθ = Math.cos(θ);\n        const sinθ = Math.sin(θ);\n        \n        const points = drawing.points.map((point) => {\n            const offsetX = point[0] - xCenterOffset;\n            const offsetY = point[1] - yCenterOffset;\n            const rotatedX = (offsetX * cosθ - offsetY * sinθ);\n            const rotatedY = (offsetY * cosθ + offsetX * sinθ);\n            //console.log( x, y, width, height, offsetX, offsetY, rotatedX, rotatedY, xCenterOffset, yCenterOffset);\n            return [rotatedX + x + xCenterOffset, rotatedY + y + yCenterOffset];\n            \n        });\n        //console.log(points)\n        \n        return points\n            .slice(0, points.length - 1)\n            .map((point, i) => ({ c: point.concat(points[i + 1]) }));\n    });\n    //console.log(drawings, newWalls);\n    canvas.scene.createEmbeddedDocuments(\"Wall\", newWalls);\n    canvas.walls.activate();","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{},"_stats":{"systemId":"gurps","systemVersion":"0.15.12","coreVersion":"10.291","createdTime":1670095991221,"modifiedTime":1670257956823,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"q8DU3gyMbvtRBgxB"}
{"name":"#[CF_tempEntity]","type":"chat","command":"","flags":{"cf":{"id":"temp_cngbk5ad9e4","name":"Visual","color":"#000000","fontColor":"#FFFFFF","icon":"","sorting":"m","contents":["gP7U7iCoJI3i43Kf","Wa4WkvigEnbtzRhE","OKo3T3t4ty3SFu5m"],"children":[],"folderPath":[],"version":"2.5.6"}},"author":"mW8b5k19Zu6i2R2v","img":"icons/svg/dice-target.svg","scope":"global","folder":null,"sort":0,"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.17","coreVersion":"10.291","createdTime":1670272542345,"modifiedTime":1671274587293,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"_id":"uWzC6U7OJIpqLo11"}
{"name":"Compendium Menu","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/sundries/books/book-embossed-blue.webp","scope":"global","command":"const managerType = 'Compendium Menu';\n\n(()=>{\n  const journals = [\n    \n    \"gurps-instant-defaults.GURPS4E-Basic-Set\" , \n    \"GURPS-Modifier-Tables.tables\",\n    \"gurps-instant-defaults.GURPS4E-Dungeon-Fantasy-RPG\",\n    \"GURPS RollTables\"\n   \n\n  ];\n\n  let path = 'icons/sundries/books/',\nfiles = [\n    'book-backed-silver-gold.webp', \n    'book-worn-brown-grey.webp',\n     'book-worn-blue.webp',\n      'book-symbol-canterbury-cross.webp',\n       'book-symbol-triangle-silver-purple.webp',\n        'book-tooled-silver-blue.webp',\n         'book-symbol-fire-gold-orange.webp',\n          'book-stack.webp',\n           'book-embossed-spiral-purple-white.webp',\n            'book-symbol-leaf-green.webp']\ni = Math.floor(Math.random()*files.length);\nlet imagem = (path+files[i]);\nconsole.log(imagem)\n\n    let buttons = {}, dialog, content = `<div sytle=\"width:100%;text-align:center;><h2>Choose Journal</h2></div>`;\n  \n  \n  journals.forEach((str)=> {\n    let journal = game.packs.get(str);\n    if(!journal) return;\n    const name = journal.metadata.label;\n\n    buttons[str] = {\n      label : `\n        <div style=\"display:flex;flex-direction:row;justify-content:center;align-items:center;\">\n          \n        <div style=\"display:flex;justify-content:left;flex-grow:1;\">\n        \n        <img src=\"${imagem}\" width=\"50\" height=\"50\" style=\"background-color:#5c5c5c;;border-radius: 10px;margin: 3px 3px 3px;\"/></div>\n\n        <div style=\"display:flex;justify-content:left;flex-grow:1\"><label>${name}</label></div>\n        </div>`,\n      callback : () => {\n        game.packs.get(str).render(true);\n       dialog.render(true);\n      }\n    }\n  });\n  dialog = new Dialog({title : `${managerType}`,content, buttons}).render(true);\n})();","flags":{"core":{"sourceId":"Macro.qsWPXt5DBqz5Yis1"},"cf":{"id":"temp_pn0x3le0bx"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547624,"modifiedTime":1669696547624,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"wyNigTPiNMYjTunO"}
{"name":"Bet on it","type":"script","author":"mW8b5k19Zu6i2R2v","img":"icons/sundries/gaming/playing-cards.webp","scope":"global","command":"const myContent = await renderTemplate(\"modules/gurps-instant-defaults/templates/gambling2.html\");\n\nnew Dialog({\n  title: \"GURPS\",\n  content: myContent,\n  buttons: {}\n}, { id: 'gambling'}).render(true);","flags":{"core":{"sourceId":"Macro.Uudkyh1b9ZGrjvvH"},"cf":{"id":"temp_etvk8gr4cam"}},"ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"_stats":{"systemId":"gurps","systemVersion":"0.15.11","coreVersion":"10.288","createdTime":1669696547622,"modifiedTime":1669696547622,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":"qngFmTxsfoMaHPES","sort":0,"_id":"xd9cFMkOzEQTdXE1"}
{"name":"XP Giver","type":"script","scope":"global","author":"mW8b5k19Zu6i2R2v","img":"icons/environment/wilderness/tree-oak.webp","command":"const myContent = `<style>\n    .callheader {\n      background-color: black;\n      font-family: Roboto, sans-serif;\n      color: white;\n      text-align: center;\n      vertical-align: middle;\n      line-height: 50px;\n      height: 50px;\n      margin-bottom: 10px;\n      border-radius: 0.375rem;\n      font-size: 18px;\n      text-decoration: none;\n    }\n  </style>\n  <div class=\"callheader\">XP Giver</div>\n\n  <form>\n    <div class=\"form-group\">\n      <label>How many points? </label>\n      <div class=\"form-fields\">\n        <input id=\"sizes\" type=\"number\" name=\"sizes\">\n      </div>\n    </div>\n  </form>\n \n  <br>\n  <button class=\"banana-set-size\" role=\"button\">Give XP</button> \n   <button class=\"register\" role=\"button\">Register xp\n</button>\n\n`;\n\nnew Dialog({\n  title: \"GURPS\",\n  content: myContent,\n  buttons: {},\n  render: async (html) => listeners(html)\n}).render(true);\nasync function listeners(html) {\n\n\n  html.click(async function (event) {\n    if (event.target.className === \"banana-set-size\") {\n\n\n      let actors = canvas.tokens.controlled.map((i) => i.actor);\n      for (const actor of actors) {\n        const pontos = html.find(\"#sizes\").val();\n        const pontosAtuais = actor.system.totalpoints.unspent;\n        const resultado = Math.floor(Number(pontosAtuais) + Number(pontos))\n        await actor.update({ \"system.totalpoints.unspent\": resultado });\n        await ChatMessage.create({\n          content: `<p>${actor.name} have <b>${resultado}XP now</b></p>`,\n        });\n      }\n    }\n      if (event.target.className === \"register\") {\n\nconst date = new Date().toDateString();\nconst pageName = `Session ${date}`;\nconst journal = game.journal.getName(\"xp\");\n\nlet entry = journal.pages.find(e => e.name === pageName);\nif(!entry) {\n    let pageContent = \" \"\n    let pageActual = ' '\n    let title = `     <th style=\"text-align: left; padding-left: 10px; \">Name</th>    <th style=\"text-align: left; \">Points</th> <th style=\"text-align: left; \">Unspent</th>`\n    let titulo = `<b>[ ${date} ]</b></br>`;\n   \nlet actors = canvas.tokens.controlled.map((i) => i.actor);\nfor (const actor of actors) {\n  const unspent = actor.system.totalpoints.unspent\n  const points = actor.system.totalpoints.total\n\n          \n          pageContent += `<tr><td> ${actor.name}</td><td>${points}</td><td>${unspent}</td></tr>`;\n        \n          \n          \n\n\n    }\n    \n\n  await JournalEntryPage.create({name: pageName, text: {content: '<table>' + '<thead>' + '<tr>' + title + '</tr>'  + pageContent  +   '</tbody>' + \n '</table>' , format: 1}, title: {show: false, level: 1}, \"ownership.default\": 3, sort: journal.sheet._pages.at(-1).sort + CONST.SORT_INTEGER_DENSITY}, {parent: journal});\n    journal.sheet.render(true);\n    //saveDataToFile(fileContent, \"text/plain\", fileName);\n}\nelse return ui.notifications.warn(`Journal Page - ${pageName} already exists`);\n    }\n  });\n}","ownership":{"default":0,"mW8b5k19Zu6i2R2v":3},"flags":{"core":{"sourceId":"Macro.Rc2VnwMmcJ85IVzE"}},"_stats":{"systemId":"gurps","systemVersion":"0.15.17","coreVersion":"10.291","createdTime":1672541433198,"modifiedTime":1672541720467,"lastModifiedBy":"mW8b5k19Zu6i2R2v"},"folder":null,"sort":0,"_id":"ywshhdWAQ4L4uE00"}
